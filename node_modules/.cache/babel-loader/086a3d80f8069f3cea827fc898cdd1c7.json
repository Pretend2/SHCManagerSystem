{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { h, defineComponent, computed, provide, toRef, ref, Fragment, Teleport, nextTick } from 'vue';\nimport { createId } from 'seemly';\nimport { useMergedState } from 'vooks';\nimport { useConfig, useTheme, useFormItem, useThemeClass } from '../../_mixins';\nimport { warn, call, throwError } from '../../_utils';\nimport { uploadLight } from '../styles';\nimport { uploadDraggerKey } from './UploadDragger';\nimport { uploadInjectionKey } from './interface';\nimport { createImageDataUrl, createSettledFileInfo, matchType } from './utils';\nimport NUploadTrigger from './UploadTrigger';\nimport NUploadFileList from './UploadFileList';\nimport style from './styles/index.cssr';\n/**\n * fils status ['pending', 'uploading', 'finished', 'removed', 'error']\n */\n\nfunction createXhrHandlers(inst, file, xhr) {\n  const {\n    doChange,\n    xhrMap\n  } = inst;\n  let percentage = 0;\n\n  function handleXHRError(e) {\n    var _a;\n\n    let fileAfterChange = Object.assign({}, file, {\n      status: 'error',\n      percentage\n    });\n    xhrMap.delete(file.id);\n    fileAfterChange = createSettledFileInfo(((_a = inst.onError) === null || _a === void 0 ? void 0 : _a.call(inst, {\n      file: fileAfterChange,\n      event: e\n    })) || fileAfterChange);\n    doChange(fileAfterChange, e);\n  }\n\n  function handleXHRLoad(e) {\n    var _a;\n\n    if (inst.isErrorState) {\n      if (inst.isErrorState(xhr)) {\n        handleXHRError(e);\n        return;\n      }\n    } else {\n      if (xhr.status < 200 || xhr.status >= 300) {\n        handleXHRError(e);\n        return;\n      }\n    }\n\n    let fileAfterChange = Object.assign({}, file, {\n      status: 'finished',\n      percentage,\n      file: null\n    });\n    xhrMap.delete(file.id);\n    fileAfterChange = createSettledFileInfo(((_a = inst.onFinish) === null || _a === void 0 ? void 0 : _a.call(inst, {\n      file: fileAfterChange,\n      event: e\n    })) || fileAfterChange);\n    doChange(fileAfterChange, e);\n  }\n\n  return {\n    handleXHRLoad,\n    handleXHRError,\n\n    handleXHRAbort(e) {\n      const fileAfterChange = Object.assign({}, file, {\n        status: 'removed',\n        file: null,\n        percentage\n      });\n      xhrMap.delete(file.id);\n      doChange(fileAfterChange, e);\n    },\n\n    handleXHRProgress(e) {\n      const fileAfterChange = Object.assign({}, file, {\n        status: 'uploading'\n      });\n\n      if (e.lengthComputable) {\n        const progress = Math.ceil(e.loaded / e.total * 100);\n        fileAfterChange.percentage = progress;\n        percentage = progress;\n      }\n\n      doChange(fileAfterChange, e);\n    }\n\n  };\n}\n\nfunction customSubmitImpl(options) {\n  const {\n    inst,\n    file,\n    data,\n    headers,\n    withCredentials,\n    action,\n    customRequest\n  } = options;\n  const {\n    doChange\n  } = options.inst;\n  let percentage = 0;\n  customRequest({\n    file,\n    data,\n    headers,\n    withCredentials,\n    action,\n\n    onProgress(event) {\n      const fileAfterChange = Object.assign({}, file, {\n        status: 'uploading'\n      });\n      const progress = event.percent;\n      fileAfterChange.percentage = progress;\n      percentage = progress;\n      doChange(fileAfterChange);\n    },\n\n    onFinish() {\n      var _a;\n\n      let fileAfterChange = Object.assign({}, file, {\n        status: 'finished',\n        percentage,\n        file: null\n      });\n      fileAfterChange = createSettledFileInfo(((_a = inst.onFinish) === null || _a === void 0 ? void 0 : _a.call(inst, {\n        file: fileAfterChange\n      })) || fileAfterChange);\n      doChange(fileAfterChange);\n    },\n\n    onError() {\n      var _a;\n\n      let fileAfterChange = Object.assign({}, file, {\n        status: 'error',\n        percentage\n      });\n      fileAfterChange = createSettledFileInfo(((_a = inst.onError) === null || _a === void 0 ? void 0 : _a.call(inst, {\n        file: fileAfterChange\n      })) || fileAfterChange);\n      doChange(fileAfterChange);\n    }\n\n  });\n}\n\nfunction registerHandler(inst, file, request) {\n  const handlers = createXhrHandlers(inst, file, request);\n  request.onabort = handlers.handleXHRAbort;\n  request.onerror = handlers.handleXHRError;\n  request.onload = handlers.handleXHRLoad;\n\n  if (request.upload) {\n    request.upload.onprogress = handlers.handleXHRProgress;\n  }\n}\n\nfunction unwrapFunctionValue(data, file) {\n  if (typeof data === 'function') {\n    return data({\n      file\n    });\n  }\n\n  if (data) return data;\n  return {};\n}\n\nfunction setHeaders(request, headers, file) {\n  const headersObject = unwrapFunctionValue(headers, file);\n  if (!headersObject) return;\n  Object.keys(headersObject).forEach(key => {\n    request.setRequestHeader(key, headersObject[key]);\n  });\n}\n\nfunction appendData(formData, data, file) {\n  const dataObject = unwrapFunctionValue(data, file);\n  if (!dataObject) return;\n  Object.keys(dataObject).forEach(key => {\n    formData.append(key, dataObject[key]);\n  });\n}\n\nfunction submitImpl(inst, fieldName, file, {\n  method,\n  action,\n  withCredentials,\n  responseType,\n  headers,\n  data\n}) {\n  const request = new XMLHttpRequest();\n  request.responseType = responseType;\n  inst.xhrMap.set(file.id, request);\n  request.withCredentials = withCredentials;\n  const formData = new FormData();\n  appendData(formData, data, file);\n  formData.append(fieldName, file.file);\n  registerHandler(inst, file, request);\n\n  if (action !== undefined) {\n    request.open(method.toUpperCase(), action);\n    setHeaders(request, headers, file);\n    request.send(formData);\n    const fileAfterChange = Object.assign({}, file, {\n      status: 'uploading'\n    });\n    inst.doChange(fileAfterChange);\n  }\n}\n\nexport const uploadProps = Object.assign(Object.assign({}, useTheme.props), {\n  name: {\n    type: String,\n    default: 'file'\n  },\n  accept: String,\n  action: String,\n  customRequest: Function,\n  directory: Boolean,\n  directoryDnd: {\n    type: Boolean,\n    default: undefined\n  },\n  method: {\n    type: String,\n    default: 'POST'\n  },\n  multiple: Boolean,\n  showFileList: {\n    type: Boolean,\n    default: true\n  },\n  data: [Object, Function],\n  headers: [Object, Function],\n  withCredentials: Boolean,\n  responseType: {\n    type: String,\n    default: ''\n  },\n  disabled: {\n    type: Boolean,\n    default: undefined\n  },\n  onChange: Function,\n  onRemove: Function,\n  onFinish: Function,\n  onError: Function,\n  onBeforeUpload: Function,\n  isErrorState: Function,\n\n  /** currently not used */\n  onDownload: Function,\n  defaultUpload: {\n    type: Boolean,\n    default: true\n  },\n  fileList: Array,\n  'onUpdate:fileList': [Function, Array],\n  onUpdateFileList: [Function, Array],\n  fileListStyle: [String, Object],\n  defaultFileList: {\n    type: Array,\n    default: () => []\n  },\n  showCancelButton: {\n    type: Boolean,\n    default: true\n  },\n  showRemoveButton: {\n    type: Boolean,\n    default: true\n  },\n  showDownloadButton: Boolean,\n  showRetryButton: {\n    type: Boolean,\n    default: true\n  },\n  showPreviewButton: {\n    type: Boolean,\n    default: true\n  },\n  listType: {\n    type: String,\n    default: 'text'\n  },\n  onPreview: Function,\n  createThumbnailUrl: Function,\n  abstract: Boolean,\n  max: Number,\n  showTrigger: {\n    type: Boolean,\n    default: true\n  },\n  imageGroupProps: Object,\n  inputProps: Object,\n  triggerStyle: [String, Object]\n});\nexport default defineComponent({\n  name: 'Upload',\n  props: uploadProps,\n\n  setup(props) {\n    if (props.abstract && props.listType === 'image-card') {\n      throwError('upload', 'when the list-type is image-card, abstract is not supported.');\n    }\n\n    const {\n      mergedClsPrefixRef,\n      inlineThemeDisabled\n    } = useConfig(props);\n    const themeRef = useTheme('Upload', '-upload', style, uploadLight, props, mergedClsPrefixRef);\n    const formItem = useFormItem(props);\n    const maxReachedRef = computed(() => {\n      const {\n        max\n      } = props;\n\n      if (max !== undefined) {\n        return mergedFileListRef.value.length >= max;\n      }\n\n      return false;\n    });\n    const uncontrolledFileListRef = ref(props.defaultFileList);\n    const controlledFileListRef = toRef(props, 'fileList');\n    const inputElRef = ref(null);\n    const draggerInsideRef = {\n      value: false\n    };\n    const dragOverRef = ref(false);\n    const xhrMap = new Map();\n\n    const _mergedFileListRef = useMergedState(controlledFileListRef, uncontrolledFileListRef);\n\n    const mergedFileListRef = computed(() => _mergedFileListRef.value.map(createSettledFileInfo));\n\n    function openOpenFileDialog() {\n      var _a;\n\n      (_a = inputElRef.value) === null || _a === void 0 ? void 0 : _a.click();\n    }\n\n    function handleFileInputChange(e) {\n      const target = e.target;\n      handleFileAddition(target.files ? Array.from(target.files).map(file => ({\n        file,\n        entry: null,\n        source: 'input'\n      })) : null, e); // May have bug! set to null?\n\n      target.value = '';\n    }\n\n    function doUpdateFileList(files) {\n      const {\n        'onUpdate:fileList': _onUpdateFileList,\n        onUpdateFileList\n      } = props;\n      if (_onUpdateFileList) call(_onUpdateFileList, files);\n      if (onUpdateFileList) call(onUpdateFileList, files);\n      uncontrolledFileListRef.value = files;\n    }\n\n    const mergedMultipleRef = computed(() => props.multiple || props.directory);\n\n    function handleFileAddition(fileAndEntries, e) {\n      if (!fileAndEntries || fileAndEntries.length === 0) return;\n      const {\n        onBeforeUpload\n      } = props;\n      fileAndEntries = mergedMultipleRef.value ? fileAndEntries : [fileAndEntries[0]];\n      const {\n        max,\n        accept\n      } = props;\n      fileAndEntries = fileAndEntries.filter(({\n        file,\n        source\n      }) => {\n        if (source === 'dnd' && (accept === null || accept === void 0 ? void 0 : accept.trim())) {\n          return matchType(file.name, file.type, accept);\n        } else {\n          return true;\n        }\n      });\n\n      if (max) {\n        fileAndEntries = fileAndEntries.slice(0, max - mergedFileListRef.value.length);\n      }\n\n      const batchId = createId();\n      void Promise.all(fileAndEntries.map(({\n        file,\n        entry\n      }) => __awaiter(this, void 0, void 0, function* () {\n        var _a;\n\n        const fileInfo = {\n          id: createId(),\n          batchId,\n          name: file.name,\n          status: 'pending',\n          percentage: 0,\n          file,\n          url: null,\n          type: file.type,\n          thumbnailUrl: null,\n          fullPath: (_a = entry === null || entry === void 0 ? void 0 : entry.fullPath) !== null && _a !== void 0 ? _a : `/${file.webkitRelativePath || file.name}`\n        };\n\n        if (!onBeforeUpload || (yield onBeforeUpload({\n          file: fileInfo,\n          fileList: mergedFileListRef.value\n        })) !== false) {\n          return fileInfo;\n        }\n\n        return null;\n      }))).then(fileInfos => __awaiter(this, void 0, void 0, function* () {\n        let nextTickChain = Promise.resolve();\n        fileInfos.forEach(fileInfo => {\n          nextTickChain = nextTickChain.then(nextTick).then(() => {\n            fileInfo && doChange(fileInfo, e, {\n              append: true\n            });\n          });\n        });\n        return yield nextTickChain;\n      })).then(() => {\n        if (props.defaultUpload) {\n          submit();\n        }\n      });\n    }\n\n    function submit(fileId) {\n      const {\n        method,\n        action,\n        withCredentials,\n        headers,\n        data,\n        name: fieldName\n      } = props;\n      const filesToUpload = fileId !== undefined ? mergedFileListRef.value.filter(file => file.id === fileId) : mergedFileListRef.value;\n      const shouldReupload = fileId !== undefined;\n      filesToUpload.forEach(file => {\n        const {\n          status\n        } = file;\n\n        if (status === 'pending' || status === 'error' && shouldReupload) {\n          if (props.customRequest) {\n            customSubmitImpl({\n              inst: {\n                doChange,\n                xhrMap,\n                onFinish: props.onFinish,\n                onError: props.onError\n              },\n              file,\n              action,\n              withCredentials,\n              headers,\n              data,\n              customRequest: props.customRequest\n            });\n          } else {\n            submitImpl({\n              doChange,\n              xhrMap,\n              onFinish: props.onFinish,\n              onError: props.onError,\n              isErrorState: props.isErrorState\n            }, fieldName, file, {\n              method,\n              action,\n              withCredentials,\n              responseType: props.responseType,\n              headers,\n              data\n            });\n          }\n        }\n      });\n    }\n\n    const doChange = (fileAfterChange, event, options = {\n      append: false,\n      remove: false\n    }) => {\n      const {\n        append,\n        remove\n      } = options;\n      const fileListAfterChange = Array.from(mergedFileListRef.value);\n      const fileIndex = fileListAfterChange.findIndex(file => file.id === fileAfterChange.id);\n\n      if (append || remove || ~fileIndex) {\n        if (append) {\n          fileListAfterChange.push(fileAfterChange);\n        } else if (remove) {\n          fileListAfterChange.splice(fileIndex, 1);\n        } else {\n          fileListAfterChange.splice(fileIndex, 1, fileAfterChange);\n        }\n\n        const {\n          onChange\n        } = props;\n\n        if (onChange) {\n          onChange({\n            file: fileAfterChange,\n            fileList: fileListAfterChange,\n            event\n          });\n        }\n\n        doUpdateFileList(fileListAfterChange);\n      } else if (process.env.NODE_ENV !== 'production') {\n        warn('upload', 'File has no corresponding id in current file list.');\n      }\n    };\n\n    function getFileThumbnailUrl(file) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const {\n          createThumbnailUrl\n        } = props;\n        return createThumbnailUrl ? yield createThumbnailUrl(file.file) : yield createImageDataUrl(file.file);\n      });\n    }\n\n    const cssVarsRef = computed(() => {\n      const {\n        common: {\n          cubicBezierEaseInOut\n        },\n        self: {\n          draggerColor,\n          draggerBorder,\n          draggerBorderHover,\n          itemColorHover,\n          itemColorHoverError,\n          itemTextColorError,\n          itemTextColorSuccess,\n          itemTextColor,\n          itemIconColor,\n          itemDisabledOpacity,\n          lineHeight,\n          borderRadius,\n          fontSize,\n          itemBorderImageCardError,\n          itemBorderImageCard\n        }\n      } = themeRef.value;\n      return {\n        '--n-bezier': cubicBezierEaseInOut,\n        '--n-border-radius': borderRadius,\n        '--n-dragger-border': draggerBorder,\n        '--n-dragger-border-hover': draggerBorderHover,\n        '--n-dragger-color': draggerColor,\n        '--n-font-size': fontSize,\n        '--n-item-color-hover': itemColorHover,\n        '--n-item-color-hover-error': itemColorHoverError,\n        '--n-item-disabled-opacity': itemDisabledOpacity,\n        '--n-item-icon-color': itemIconColor,\n        '--n-item-text-color': itemTextColor,\n        '--n-item-text-color-error': itemTextColorError,\n        '--n-item-text-color-success': itemTextColorSuccess,\n        '--n-line-height': lineHeight,\n        '--n-item-border-image-card-error': itemBorderImageCardError,\n        '--n-item-border-image-card': itemBorderImageCard\n      };\n    });\n    const themeClassHandle = inlineThemeDisabled ? useThemeClass('upload', undefined, cssVarsRef, props) : undefined;\n    provide(uploadInjectionKey, {\n      mergedClsPrefixRef,\n      mergedThemeRef: themeRef,\n      showCancelButtonRef: toRef(props, 'showCancelButton'),\n      showDownloadButtonRef: toRef(props, 'showDownloadButton'),\n      showRemoveButtonRef: toRef(props, 'showRemoveButton'),\n      showRetryButtonRef: toRef(props, 'showRetryButton'),\n      onRemoveRef: toRef(props, 'onRemove'),\n      onDownloadRef: toRef(props, 'onDownload'),\n      mergedFileListRef,\n      triggerStyleRef: toRef(props, 'triggerStyle'),\n      xhrMap,\n      submit,\n      doChange,\n      showPreviewButtonRef: toRef(props, 'showPreviewButton'),\n      onPreviewRef: toRef(props, 'onPreview'),\n      getFileThumbnailUrl,\n      listTypeRef: toRef(props, 'listType'),\n      dragOverRef,\n      openOpenFileDialog,\n      draggerInsideRef,\n      handleFileAddition,\n      mergedDisabledRef: formItem.mergedDisabledRef,\n      maxReachedRef,\n      fileListStyleRef: toRef(props, 'fileListStyle'),\n      abstractRef: toRef(props, 'abstract'),\n      acceptRef: toRef(props, 'accept'),\n      cssVarsRef: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClassRef: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender,\n      showTriggerRef: toRef(props, 'showTrigger'),\n      imageGroupPropsRef: toRef(props, 'imageGroupProps'),\n      mergedDirectoryDndRef: computed(() => {\n        var _a;\n\n        return (_a = props.directoryDnd) !== null && _a !== void 0 ? _a : props.directory;\n      })\n    });\n    const exposedMethods = {\n      clear: () => {\n        uncontrolledFileListRef.value = [];\n      },\n      submit,\n      openOpenFileDialog\n    };\n    return Object.assign({\n      mergedClsPrefix: mergedClsPrefixRef,\n      draggerInsideRef,\n      inputElRef,\n      mergedTheme: themeRef,\n      dragOver: dragOverRef,\n      mergedMultiple: mergedMultipleRef,\n      cssVars: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender,\n      handleFileInputChange\n    }, exposedMethods);\n  },\n\n  render() {\n    var _a, _b;\n\n    const {\n      draggerInsideRef,\n      mergedClsPrefix,\n      $slots,\n      directory,\n      onRender\n    } = this;\n\n    if ($slots.default && !this.abstract) {\n      const firstChild = $slots.default()[0];\n\n      if ((_a = firstChild === null || firstChild === void 0 ? void 0 : firstChild.type) === null || _a === void 0 ? void 0 : _a[uploadDraggerKey]) {\n        draggerInsideRef.value = true;\n      }\n    }\n\n    const inputNode = h(\"input\", Object.assign({}, this.inputProps, {\n      ref: \"inputElRef\",\n      type: \"file\",\n      class: `${mergedClsPrefix}-upload-file-input`,\n      accept: this.accept,\n      multiple: this.mergedMultiple,\n      onChange: this.handleFileInputChange,\n      // eslint-disable-next-line @typescript-eslint/prefer-ts-expect-error\n      // @ts-ignore // seems vue-tsc will add the prop, so we can't use expect-error\n      webkitdirectory: directory,\n      directory: directory\n    }));\n\n    if (this.abstract) {\n      return h(Fragment, null, (_b = $slots.default) === null || _b === void 0 ? void 0 : _b.call($slots), h(Teleport, {\n        to: \"body\"\n      }, inputNode));\n    }\n\n    onRender === null || onRender === void 0 ? void 0 : onRender();\n    return h(\"div\", {\n      class: [`${mergedClsPrefix}-upload`, draggerInsideRef.value && `${mergedClsPrefix}-upload--dragger-inside`, this.dragOver && `${mergedClsPrefix}-upload--drag-over`, this.themeClass],\n      style: this.cssVars\n    }, inputNode, this.showTrigger && this.listType !== 'image-card' && h(NUploadTrigger, null, $slots), this.showFileList && h(NUploadFileList, null, $slots));\n  }\n\n});","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","h","defineComponent","computed","provide","toRef","ref","Fragment","Teleport","nextTick","createId","useMergedState","useConfig","useTheme","useFormItem","useThemeClass","warn","call","throwError","uploadLight","uploadDraggerKey","uploadInjectionKey","createImageDataUrl","createSettledFileInfo","matchType","NUploadTrigger","NUploadFileList","style","createXhrHandlers","inst","file","xhr","doChange","xhrMap","percentage","handleXHRError","_a","fileAfterChange","Object","assign","status","delete","id","onError","event","handleXHRLoad","isErrorState","onFinish","handleXHRAbort","handleXHRProgress","lengthComputable","progress","Math","ceil","loaded","total","customSubmitImpl","options","data","headers","withCredentials","action","customRequest","onProgress","percent","registerHandler","request","handlers","onabort","onerror","onload","upload","onprogress","unwrapFunctionValue","setHeaders","headersObject","keys","forEach","key","setRequestHeader","appendData","formData","dataObject","append","submitImpl","fieldName","method","responseType","XMLHttpRequest","set","FormData","undefined","open","toUpperCase","send","uploadProps","props","name","type","String","default","accept","Function","directory","Boolean","directoryDnd","multiple","showFileList","disabled","onChange","onRemove","onBeforeUpload","onDownload","defaultUpload","fileList","Array","onUpdateFileList","fileListStyle","defaultFileList","showCancelButton","showRemoveButton","showDownloadButton","showRetryButton","showPreviewButton","listType","onPreview","createThumbnailUrl","abstract","max","Number","showTrigger","imageGroupProps","inputProps","triggerStyle","setup","mergedClsPrefixRef","inlineThemeDisabled","themeRef","formItem","maxReachedRef","mergedFileListRef","length","uncontrolledFileListRef","controlledFileListRef","inputElRef","draggerInsideRef","dragOverRef","Map","_mergedFileListRef","map","openOpenFileDialog","click","handleFileInputChange","target","handleFileAddition","files","from","entry","source","doUpdateFileList","_onUpdateFileList","mergedMultipleRef","fileAndEntries","filter","trim","slice","batchId","all","fileInfo","url","thumbnailUrl","fullPath","webkitRelativePath","fileInfos","nextTickChain","submit","fileId","filesToUpload","shouldReupload","remove","fileListAfterChange","fileIndex","findIndex","push","splice","process","env","NODE_ENV","getFileThumbnailUrl","cssVarsRef","common","cubicBezierEaseInOut","self","draggerColor","draggerBorder","draggerBorderHover","itemColorHover","itemColorHoverError","itemTextColorError","itemTextColorSuccess","itemTextColor","itemIconColor","itemDisabledOpacity","lineHeight","borderRadius","fontSize","itemBorderImageCardError","itemBorderImageCard","themeClassHandle","mergedThemeRef","showCancelButtonRef","showDownloadButtonRef","showRemoveButtonRef","showRetryButtonRef","onRemoveRef","onDownloadRef","triggerStyleRef","showPreviewButtonRef","onPreviewRef","listTypeRef","mergedDisabledRef","fileListStyleRef","abstractRef","acceptRef","themeClassRef","themeClass","onRender","showTriggerRef","imageGroupPropsRef","mergedDirectoryDndRef","exposedMethods","clear","mergedClsPrefix","mergedTheme","dragOver","mergedMultiple","cssVars","render","_b","$slots","firstChild","inputNode","class","webkitdirectory","to"],"sources":["E:/VCode/SHC社区管理系统/shc_community_manager_system/node_modules/naive-ui/es/upload/src/Upload.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { h, defineComponent, computed, provide, toRef, ref, Fragment, Teleport, nextTick } from 'vue';\nimport { createId } from 'seemly';\nimport { useMergedState } from 'vooks';\nimport { useConfig, useTheme, useFormItem, useThemeClass } from '../../_mixins';\nimport { warn, call, throwError } from '../../_utils';\nimport { uploadLight } from '../styles';\nimport { uploadDraggerKey } from './UploadDragger';\nimport { uploadInjectionKey } from './interface';\nimport { createImageDataUrl, createSettledFileInfo, matchType } from './utils';\nimport NUploadTrigger from './UploadTrigger';\nimport NUploadFileList from './UploadFileList';\nimport style from './styles/index.cssr';\n/**\n * fils status ['pending', 'uploading', 'finished', 'removed', 'error']\n */\nfunction createXhrHandlers(inst, file, xhr) {\n    const { doChange, xhrMap } = inst;\n    let percentage = 0;\n    function handleXHRError(e) {\n        var _a;\n        let fileAfterChange = Object.assign({}, file, {\n            status: 'error',\n            percentage\n        });\n        xhrMap.delete(file.id);\n        fileAfterChange = createSettledFileInfo(((_a = inst.onError) === null || _a === void 0 ? void 0 : _a.call(inst, { file: fileAfterChange, event: e })) || fileAfterChange);\n        doChange(fileAfterChange, e);\n    }\n    function handleXHRLoad(e) {\n        var _a;\n        if (inst.isErrorState) {\n            if (inst.isErrorState(xhr)) {\n                handleXHRError(e);\n                return;\n            }\n        }\n        else {\n            if (xhr.status < 200 || xhr.status >= 300) {\n                handleXHRError(e);\n                return;\n            }\n        }\n        let fileAfterChange = Object.assign({}, file, {\n            status: 'finished',\n            percentage,\n            file: null\n        });\n        xhrMap.delete(file.id);\n        fileAfterChange = createSettledFileInfo(((_a = inst.onFinish) === null || _a === void 0 ? void 0 : _a.call(inst, { file: fileAfterChange, event: e })) || fileAfterChange);\n        doChange(fileAfterChange, e);\n    }\n    return {\n        handleXHRLoad,\n        handleXHRError,\n        handleXHRAbort(e) {\n            const fileAfterChange = Object.assign({}, file, {\n                status: 'removed',\n                file: null,\n                percentage\n            });\n            xhrMap.delete(file.id);\n            doChange(fileAfterChange, e);\n        },\n        handleXHRProgress(e) {\n            const fileAfterChange = Object.assign({}, file, {\n                status: 'uploading'\n            });\n            if (e.lengthComputable) {\n                const progress = Math.ceil((e.loaded / e.total) * 100);\n                fileAfterChange.percentage = progress;\n                percentage = progress;\n            }\n            doChange(fileAfterChange, e);\n        }\n    };\n}\nfunction customSubmitImpl(options) {\n    const { inst, file, data, headers, withCredentials, action, customRequest } = options;\n    const { doChange } = options.inst;\n    let percentage = 0;\n    customRequest({\n        file,\n        data,\n        headers,\n        withCredentials,\n        action,\n        onProgress(event) {\n            const fileAfterChange = Object.assign({}, file, {\n                status: 'uploading'\n            });\n            const progress = event.percent;\n            fileAfterChange.percentage = progress;\n            percentage = progress;\n            doChange(fileAfterChange);\n        },\n        onFinish() {\n            var _a;\n            let fileAfterChange = Object.assign({}, file, {\n                status: 'finished',\n                percentage,\n                file: null\n            });\n            fileAfterChange = createSettledFileInfo(((_a = inst.onFinish) === null || _a === void 0 ? void 0 : _a.call(inst, { file: fileAfterChange })) || fileAfterChange);\n            doChange(fileAfterChange);\n        },\n        onError() {\n            var _a;\n            let fileAfterChange = Object.assign({}, file, {\n                status: 'error',\n                percentage\n            });\n            fileAfterChange = createSettledFileInfo(((_a = inst.onError) === null || _a === void 0 ? void 0 : _a.call(inst, { file: fileAfterChange })) || fileAfterChange);\n            doChange(fileAfterChange);\n        }\n    });\n}\nfunction registerHandler(inst, file, request) {\n    const handlers = createXhrHandlers(inst, file, request);\n    request.onabort = handlers.handleXHRAbort;\n    request.onerror = handlers.handleXHRError;\n    request.onload = handlers.handleXHRLoad;\n    if (request.upload) {\n        request.upload.onprogress = handlers.handleXHRProgress;\n    }\n}\nfunction unwrapFunctionValue(data, file) {\n    if (typeof data === 'function') {\n        return data({ file });\n    }\n    if (data)\n        return data;\n    return {};\n}\nfunction setHeaders(request, headers, file) {\n    const headersObject = unwrapFunctionValue(headers, file);\n    if (!headersObject)\n        return;\n    Object.keys(headersObject).forEach((key) => {\n        request.setRequestHeader(key, headersObject[key]);\n    });\n}\nfunction appendData(formData, data, file) {\n    const dataObject = unwrapFunctionValue(data, file);\n    if (!dataObject)\n        return;\n    Object.keys(dataObject).forEach((key) => {\n        formData.append(key, dataObject[key]);\n    });\n}\nfunction submitImpl(inst, fieldName, file, { method, action, withCredentials, responseType, headers, data }) {\n    const request = new XMLHttpRequest();\n    request.responseType = responseType;\n    inst.xhrMap.set(file.id, request);\n    request.withCredentials = withCredentials;\n    const formData = new FormData();\n    appendData(formData, data, file);\n    formData.append(fieldName, file.file);\n    registerHandler(inst, file, request);\n    if (action !== undefined) {\n        request.open(method.toUpperCase(), action);\n        setHeaders(request, headers, file);\n        request.send(formData);\n        const fileAfterChange = Object.assign({}, file, {\n            status: 'uploading'\n        });\n        inst.doChange(fileAfterChange);\n    }\n}\nexport const uploadProps = Object.assign(Object.assign({}, useTheme.props), { name: {\n        type: String,\n        default: 'file'\n    }, accept: String, action: String, customRequest: Function, directory: Boolean, directoryDnd: { type: Boolean, default: undefined }, method: {\n        type: String,\n        default: 'POST'\n    }, multiple: Boolean, showFileList: {\n        type: Boolean,\n        default: true\n    }, data: [Object, Function], headers: [Object, Function], withCredentials: Boolean, responseType: {\n        type: String,\n        default: ''\n    }, disabled: {\n        type: Boolean,\n        default: undefined\n    }, onChange: Function, onRemove: Function, onFinish: Function, onError: Function, onBeforeUpload: Function, isErrorState: Function, \n    /** currently not used */\n    onDownload: Function, defaultUpload: {\n        type: Boolean,\n        default: true\n    }, fileList: Array, 'onUpdate:fileList': [Function, Array], onUpdateFileList: [Function, Array], fileListStyle: [String, Object], defaultFileList: {\n        type: Array,\n        default: () => []\n    }, showCancelButton: {\n        type: Boolean,\n        default: true\n    }, showRemoveButton: {\n        type: Boolean,\n        default: true\n    }, showDownloadButton: Boolean, showRetryButton: {\n        type: Boolean,\n        default: true\n    }, showPreviewButton: {\n        type: Boolean,\n        default: true\n    }, listType: {\n        type: String,\n        default: 'text'\n    }, onPreview: Function, createThumbnailUrl: Function, abstract: Boolean, max: Number, showTrigger: {\n        type: Boolean,\n        default: true\n    }, imageGroupProps: Object, inputProps: Object, triggerStyle: [String, Object] });\nexport default defineComponent({\n    name: 'Upload',\n    props: uploadProps,\n    setup(props) {\n        if (props.abstract && props.listType === 'image-card') {\n            throwError('upload', 'when the list-type is image-card, abstract is not supported.');\n        }\n        const { mergedClsPrefixRef, inlineThemeDisabled } = useConfig(props);\n        const themeRef = useTheme('Upload', '-upload', style, uploadLight, props, mergedClsPrefixRef);\n        const formItem = useFormItem(props);\n        const maxReachedRef = computed(() => {\n            const { max } = props;\n            if (max !== undefined) {\n                return mergedFileListRef.value.length >= max;\n            }\n            return false;\n        });\n        const uncontrolledFileListRef = ref(props.defaultFileList);\n        const controlledFileListRef = toRef(props, 'fileList');\n        const inputElRef = ref(null);\n        const draggerInsideRef = {\n            value: false\n        };\n        const dragOverRef = ref(false);\n        const xhrMap = new Map();\n        const _mergedFileListRef = useMergedState(controlledFileListRef, uncontrolledFileListRef);\n        const mergedFileListRef = computed(() => _mergedFileListRef.value.map(createSettledFileInfo));\n        function openOpenFileDialog() {\n            var _a;\n            (_a = inputElRef.value) === null || _a === void 0 ? void 0 : _a.click();\n        }\n        function handleFileInputChange(e) {\n            const target = e.target;\n            handleFileAddition(target.files\n                ? Array.from(target.files).map((file) => ({\n                    file,\n                    entry: null,\n                    source: 'input'\n                }))\n                : null, e);\n            // May have bug! set to null?\n            target.value = '';\n        }\n        function doUpdateFileList(files) {\n            const { 'onUpdate:fileList': _onUpdateFileList, onUpdateFileList } = props;\n            if (_onUpdateFileList)\n                call(_onUpdateFileList, files);\n            if (onUpdateFileList)\n                call(onUpdateFileList, files);\n            uncontrolledFileListRef.value = files;\n        }\n        const mergedMultipleRef = computed(() => props.multiple || props.directory);\n        function handleFileAddition(fileAndEntries, e) {\n            if (!fileAndEntries || fileAndEntries.length === 0)\n                return;\n            const { onBeforeUpload } = props;\n            fileAndEntries = mergedMultipleRef.value\n                ? fileAndEntries\n                : [fileAndEntries[0]];\n            const { max, accept } = props;\n            fileAndEntries = fileAndEntries.filter(({ file, source }) => {\n                if (source === 'dnd' && (accept === null || accept === void 0 ? void 0 : accept.trim())) {\n                    return matchType(file.name, file.type, accept);\n                }\n                else {\n                    return true;\n                }\n            });\n            if (max) {\n                fileAndEntries = fileAndEntries.slice(0, max - mergedFileListRef.value.length);\n            }\n            const batchId = createId();\n            void Promise.all(fileAndEntries.map(({ file, entry }) => __awaiter(this, void 0, void 0, function* () {\n                var _a;\n                const fileInfo = {\n                    id: createId(),\n                    batchId,\n                    name: file.name,\n                    status: 'pending',\n                    percentage: 0,\n                    file,\n                    url: null,\n                    type: file.type,\n                    thumbnailUrl: null,\n                    fullPath: (_a = entry === null || entry === void 0 ? void 0 : entry.fullPath) !== null && _a !== void 0 ? _a : `/${file.webkitRelativePath || file.name}`\n                };\n                if (!onBeforeUpload ||\n                    (yield onBeforeUpload({\n                        file: fileInfo,\n                        fileList: mergedFileListRef.value\n                    })) !== false) {\n                    return fileInfo;\n                }\n                return null;\n            })))\n                .then((fileInfos) => __awaiter(this, void 0, void 0, function* () {\n                let nextTickChain = Promise.resolve();\n                fileInfos.forEach((fileInfo) => {\n                    nextTickChain = nextTickChain.then(nextTick).then(() => {\n                        fileInfo &&\n                            doChange(fileInfo, e, {\n                                append: true\n                            });\n                    });\n                });\n                return yield nextTickChain;\n            }))\n                .then(() => {\n                if (props.defaultUpload) {\n                    submit();\n                }\n            });\n        }\n        function submit(fileId) {\n            const { method, action, withCredentials, headers, data, name: fieldName } = props;\n            const filesToUpload = fileId !== undefined\n                ? mergedFileListRef.value.filter((file) => file.id === fileId)\n                : mergedFileListRef.value;\n            const shouldReupload = fileId !== undefined;\n            filesToUpload.forEach((file) => {\n                const { status } = file;\n                if (status === 'pending' || (status === 'error' && shouldReupload)) {\n                    if (props.customRequest) {\n                        customSubmitImpl({\n                            inst: {\n                                doChange,\n                                xhrMap,\n                                onFinish: props.onFinish,\n                                onError: props.onError\n                            },\n                            file,\n                            action,\n                            withCredentials,\n                            headers,\n                            data,\n                            customRequest: props.customRequest\n                        });\n                    }\n                    else {\n                        submitImpl({\n                            doChange,\n                            xhrMap,\n                            onFinish: props.onFinish,\n                            onError: props.onError,\n                            isErrorState: props.isErrorState\n                        }, fieldName, file, {\n                            method,\n                            action,\n                            withCredentials,\n                            responseType: props.responseType,\n                            headers,\n                            data\n                        });\n                    }\n                }\n            });\n        }\n        const doChange = (fileAfterChange, event, options = {\n            append: false,\n            remove: false\n        }) => {\n            const { append, remove } = options;\n            const fileListAfterChange = Array.from(mergedFileListRef.value);\n            const fileIndex = fileListAfterChange.findIndex((file) => file.id === fileAfterChange.id);\n            if (append || remove || ~fileIndex) {\n                if (append) {\n                    fileListAfterChange.push(fileAfterChange);\n                }\n                else if (remove) {\n                    fileListAfterChange.splice(fileIndex, 1);\n                }\n                else {\n                    fileListAfterChange.splice(fileIndex, 1, fileAfterChange);\n                }\n                const { onChange } = props;\n                if (onChange) {\n                    onChange({\n                        file: fileAfterChange,\n                        fileList: fileListAfterChange,\n                        event\n                    });\n                }\n                doUpdateFileList(fileListAfterChange);\n            }\n            else if (process.env.NODE_ENV !== 'production') {\n                warn('upload', 'File has no corresponding id in current file list.');\n            }\n        };\n        function getFileThumbnailUrl(file) {\n            return __awaiter(this, void 0, void 0, function* () {\n                const { createThumbnailUrl } = props;\n                return createThumbnailUrl\n                    ? yield createThumbnailUrl(file.file)\n                    : yield createImageDataUrl(file.file);\n            });\n        }\n        const cssVarsRef = computed(() => {\n            const { common: { cubicBezierEaseInOut }, self: { draggerColor, draggerBorder, draggerBorderHover, itemColorHover, itemColorHoverError, itemTextColorError, itemTextColorSuccess, itemTextColor, itemIconColor, itemDisabledOpacity, lineHeight, borderRadius, fontSize, itemBorderImageCardError, itemBorderImageCard } } = themeRef.value;\n            return {\n                '--n-bezier': cubicBezierEaseInOut,\n                '--n-border-radius': borderRadius,\n                '--n-dragger-border': draggerBorder,\n                '--n-dragger-border-hover': draggerBorderHover,\n                '--n-dragger-color': draggerColor,\n                '--n-font-size': fontSize,\n                '--n-item-color-hover': itemColorHover,\n                '--n-item-color-hover-error': itemColorHoverError,\n                '--n-item-disabled-opacity': itemDisabledOpacity,\n                '--n-item-icon-color': itemIconColor,\n                '--n-item-text-color': itemTextColor,\n                '--n-item-text-color-error': itemTextColorError,\n                '--n-item-text-color-success': itemTextColorSuccess,\n                '--n-line-height': lineHeight,\n                '--n-item-border-image-card-error': itemBorderImageCardError,\n                '--n-item-border-image-card': itemBorderImageCard\n            };\n        });\n        const themeClassHandle = inlineThemeDisabled\n            ? useThemeClass('upload', undefined, cssVarsRef, props)\n            : undefined;\n        provide(uploadInjectionKey, {\n            mergedClsPrefixRef,\n            mergedThemeRef: themeRef,\n            showCancelButtonRef: toRef(props, 'showCancelButton'),\n            showDownloadButtonRef: toRef(props, 'showDownloadButton'),\n            showRemoveButtonRef: toRef(props, 'showRemoveButton'),\n            showRetryButtonRef: toRef(props, 'showRetryButton'),\n            onRemoveRef: toRef(props, 'onRemove'),\n            onDownloadRef: toRef(props, 'onDownload'),\n            mergedFileListRef,\n            triggerStyleRef: toRef(props, 'triggerStyle'),\n            xhrMap,\n            submit,\n            doChange,\n            showPreviewButtonRef: toRef(props, 'showPreviewButton'),\n            onPreviewRef: toRef(props, 'onPreview'),\n            getFileThumbnailUrl,\n            listTypeRef: toRef(props, 'listType'),\n            dragOverRef,\n            openOpenFileDialog,\n            draggerInsideRef,\n            handleFileAddition,\n            mergedDisabledRef: formItem.mergedDisabledRef,\n            maxReachedRef,\n            fileListStyleRef: toRef(props, 'fileListStyle'),\n            abstractRef: toRef(props, 'abstract'),\n            acceptRef: toRef(props, 'accept'),\n            cssVarsRef: inlineThemeDisabled ? undefined : cssVarsRef,\n            themeClassRef: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n            onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender,\n            showTriggerRef: toRef(props, 'showTrigger'),\n            imageGroupPropsRef: toRef(props, 'imageGroupProps'),\n            mergedDirectoryDndRef: computed(() => {\n                var _a;\n                return (_a = props.directoryDnd) !== null && _a !== void 0 ? _a : props.directory;\n            })\n        });\n        const exposedMethods = {\n            clear: () => {\n                uncontrolledFileListRef.value = [];\n            },\n            submit,\n            openOpenFileDialog\n        };\n        return Object.assign({ mergedClsPrefix: mergedClsPrefixRef, draggerInsideRef,\n            inputElRef, mergedTheme: themeRef, dragOver: dragOverRef, mergedMultiple: mergedMultipleRef, cssVars: inlineThemeDisabled ? undefined : cssVarsRef, themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass, onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender, handleFileInputChange }, exposedMethods);\n    },\n    render() {\n        var _a, _b;\n        const { draggerInsideRef, mergedClsPrefix, $slots, directory, onRender } = this;\n        if ($slots.default && !this.abstract) {\n            const firstChild = $slots.default()[0];\n            if ((_a = firstChild === null || firstChild === void 0 ? void 0 : firstChild.type) === null || _a === void 0 ? void 0 : _a[uploadDraggerKey]) {\n                draggerInsideRef.value = true;\n            }\n        }\n        const inputNode = (h(\"input\", Object.assign({}, this.inputProps, { ref: \"inputElRef\", type: \"file\", class: `${mergedClsPrefix}-upload-file-input`, accept: this.accept, multiple: this.mergedMultiple, onChange: this.handleFileInputChange, \n            // eslint-disable-next-line @typescript-eslint/prefer-ts-expect-error\n            // @ts-ignore // seems vue-tsc will add the prop, so we can't use expect-error\n            webkitdirectory: directory, directory: directory })));\n        if (this.abstract) {\n            return (h(Fragment, null, (_b = $slots.default) === null || _b === void 0 ? void 0 :\n                _b.call($slots),\n                h(Teleport, { to: \"body\" }, inputNode)));\n        }\n        onRender === null || onRender === void 0 ? void 0 : onRender();\n        return (h(\"div\", { class: [\n                `${mergedClsPrefix}-upload`,\n                draggerInsideRef.value && `${mergedClsPrefix}-upload--dragger-inside`,\n                this.dragOver && `${mergedClsPrefix}-upload--drag-over`,\n                this.themeClass\n            ], style: this.cssVars },\n            inputNode,\n            this.showTrigger && this.listType !== 'image-card' && (h(NUploadTrigger, null, $slots)),\n            this.showFileList && h(NUploadFileList, null, $slots)));\n    }\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}