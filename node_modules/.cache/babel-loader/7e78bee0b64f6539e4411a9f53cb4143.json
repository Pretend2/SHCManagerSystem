{"ast":null,"code":"import { h, defineComponent, ref, computed, inject } from 'vue';\nimport { FilterIcon } from '../../../_internal/icons';\nimport { NBaseIcon } from '../../../_internal';\nimport { NPopover } from '../../../popover';\nimport RenderFilter from './RenderFilter';\nimport NDataTableFilterMenu from './FilterMenu';\nimport { dataTableInjectionKey } from '../interface';\nimport { useConfig } from '../../../_mixins';\n\nfunction createFilterState(currentFilterState, columnKey, mergedFilterValue) {\n  const nextFilterState = Object.assign({}, currentFilterState);\n  nextFilterState[columnKey] = mergedFilterValue;\n  return nextFilterState;\n}\n\nexport default defineComponent({\n  name: 'DataTableFilterButton',\n  props: {\n    column: {\n      type: Object,\n      required: true\n    },\n    options: {\n      type: Array,\n      default: () => []\n    }\n  },\n\n  setup(props) {\n    const {\n      mergedComponentPropsRef\n    } = useConfig();\n    const {\n      mergedThemeRef,\n      mergedClsPrefixRef,\n      mergedFilterStateRef,\n      filterMenuCssVarsRef,\n      paginationBehaviorOnFilterRef,\n      doUpdatePage,\n      doUpdateFilters // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\n    } = inject(dataTableInjectionKey);\n    const showPopoverRef = ref(false);\n    const filterStateRef = mergedFilterStateRef;\n    const filterMultipleRef = computed(() => {\n      return props.column.filterMultiple !== false;\n    });\n    const mergedFilterValueRef = computed(() => {\n      const filterValue = filterStateRef.value[props.column.key];\n\n      if (filterValue === undefined) {\n        const {\n          value: multiple\n        } = filterMultipleRef;\n        if (multiple) return [];else return null;\n      }\n\n      return filterValue;\n    });\n    const activeRef = computed(() => {\n      const {\n        value: filterValue\n      } = mergedFilterValueRef;\n\n      if (Array.isArray(filterValue)) {\n        return filterValue.length > 0;\n      }\n\n      return filterValue !== null;\n    });\n    const mergedRenderFilterRef = computed(() => {\n      var _a, _b;\n\n      return ((_b = (_a = mergedComponentPropsRef === null || mergedComponentPropsRef === void 0 ? void 0 : mergedComponentPropsRef.value) === null || _a === void 0 ? void 0 : _a.DataTable) === null || _b === void 0 ? void 0 : _b.renderFilter) || props.column.renderFilter;\n    });\n\n    function handleFilterChange(mergedFilterValue) {\n      const nextFilterState = createFilterState(filterStateRef.value, props.column.key, mergedFilterValue);\n      doUpdateFilters(nextFilterState, props.column);\n\n      if (paginationBehaviorOnFilterRef.value === 'first') {\n        doUpdatePage(1);\n      }\n    }\n\n    function handleFilterMenuCancel() {\n      showPopoverRef.value = false;\n    }\n\n    function handleFilterMenuConfirm() {\n      showPopoverRef.value = false;\n    }\n\n    return {\n      mergedTheme: mergedThemeRef,\n      mergedClsPrefix: mergedClsPrefixRef,\n      active: activeRef,\n      showPopover: showPopoverRef,\n      mergedRenderFilter: mergedRenderFilterRef,\n      filterMultiple: filterMultipleRef,\n      mergedFilterValue: mergedFilterValueRef,\n      filterMenuCssVars: filterMenuCssVarsRef,\n      handleFilterChange,\n      handleFilterMenuConfirm,\n      handleFilterMenuCancel\n    };\n  },\n\n  render() {\n    const {\n      mergedTheme,\n      mergedClsPrefix,\n      handleFilterMenuCancel\n    } = this;\n    return h(NPopover, {\n      show: this.showPopover,\n      onUpdateShow: v => this.showPopover = v,\n      trigger: \"click\",\n      theme: mergedTheme.peers.Popover,\n      themeOverrides: mergedTheme.peerOverrides.Popover,\n      placement: \"bottom\",\n      style: {\n        padding: 0\n      }\n    }, {\n      trigger: () => {\n        const {\n          mergedRenderFilter\n        } = this;\n\n        if (mergedRenderFilter) {\n          return h(RenderFilter, {\n            \"data-data-table-filter\": true,\n            render: mergedRenderFilter,\n            active: this.active,\n            show: this.showPopover\n          });\n        }\n\n        const {\n          renderFilterIcon\n        } = this.column;\n        return h(\"div\", {\n          \"data-data-table-filter\": true,\n          class: [`${mergedClsPrefix}-data-table-filter`, {\n            [`${mergedClsPrefix}-data-table-filter--active`]: this.active,\n            [`${mergedClsPrefix}-data-table-filter--show`]: this.showPopover\n          }]\n        }, renderFilterIcon ? renderFilterIcon({\n          active: this.active,\n          show: this.showPopover\n        }) : h(NBaseIcon, {\n          clsPrefix: mergedClsPrefix\n        }, {\n          default: () => h(FilterIcon, null)\n        }));\n      },\n      default: () => {\n        const {\n          renderFilterMenu\n        } = this.column;\n        return renderFilterMenu ? renderFilterMenu({\n          hide: handleFilterMenuCancel\n        }) : h(NDataTableFilterMenu, {\n          style: this.filterMenuCssVars,\n          radioGroupName: String(this.column.key),\n          multiple: this.filterMultiple,\n          value: this.mergedFilterValue,\n          options: this.options,\n          column: this.column,\n          onChange: this.handleFilterChange,\n          onClear: this.handleFilterMenuCancel,\n          onConfirm: this.handleFilterMenuConfirm\n        });\n      }\n    });\n  }\n\n});","map":{"version":3,"names":["h","defineComponent","ref","computed","inject","FilterIcon","NBaseIcon","NPopover","RenderFilter","NDataTableFilterMenu","dataTableInjectionKey","useConfig","createFilterState","currentFilterState","columnKey","mergedFilterValue","nextFilterState","Object","assign","name","props","column","type","required","options","Array","default","setup","mergedComponentPropsRef","mergedThemeRef","mergedClsPrefixRef","mergedFilterStateRef","filterMenuCssVarsRef","paginationBehaviorOnFilterRef","doUpdatePage","doUpdateFilters","showPopoverRef","filterStateRef","filterMultipleRef","filterMultiple","mergedFilterValueRef","filterValue","value","key","undefined","multiple","activeRef","isArray","length","mergedRenderFilterRef","_a","_b","DataTable","renderFilter","handleFilterChange","handleFilterMenuCancel","handleFilterMenuConfirm","mergedTheme","mergedClsPrefix","active","showPopover","mergedRenderFilter","filterMenuCssVars","render","show","onUpdateShow","v","trigger","theme","peers","Popover","themeOverrides","peerOverrides","placement","style","padding","renderFilterIcon","class","clsPrefix","renderFilterMenu","hide","radioGroupName","String","onChange","onClear","onConfirm"],"sources":["E:/VCode/SHC社区管理系统/shc_community_manager_system/node_modules/naive-ui/es/data-table/src/HeaderButton/FilterButton.js"],"sourcesContent":["import { h, defineComponent, ref, computed, inject } from 'vue';\nimport { FilterIcon } from '../../../_internal/icons';\nimport { NBaseIcon } from '../../../_internal';\nimport { NPopover } from '../../../popover';\nimport RenderFilter from './RenderFilter';\nimport NDataTableFilterMenu from './FilterMenu';\nimport { dataTableInjectionKey } from '../interface';\nimport { useConfig } from '../../../_mixins';\nfunction createFilterState(currentFilterState, columnKey, mergedFilterValue) {\n    const nextFilterState = Object.assign({}, currentFilterState);\n    nextFilterState[columnKey] = mergedFilterValue;\n    return nextFilterState;\n}\nexport default defineComponent({\n    name: 'DataTableFilterButton',\n    props: {\n        column: {\n            type: Object,\n            required: true\n        },\n        options: {\n            type: Array,\n            default: () => []\n        }\n    },\n    setup(props) {\n        const { mergedComponentPropsRef } = useConfig();\n        const { mergedThemeRef, mergedClsPrefixRef, mergedFilterStateRef, filterMenuCssVarsRef, paginationBehaviorOnFilterRef, doUpdatePage, doUpdateFilters\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n         } = inject(dataTableInjectionKey);\n        const showPopoverRef = ref(false);\n        const filterStateRef = mergedFilterStateRef;\n        const filterMultipleRef = computed(() => {\n            return props.column.filterMultiple !== false;\n        });\n        const mergedFilterValueRef = computed(() => {\n            const filterValue = filterStateRef.value[props.column.key];\n            if (filterValue === undefined) {\n                const { value: multiple } = filterMultipleRef;\n                if (multiple)\n                    return [];\n                else\n                    return null;\n            }\n            return filterValue;\n        });\n        const activeRef = computed(() => {\n            const { value: filterValue } = mergedFilterValueRef;\n            if (Array.isArray(filterValue)) {\n                return filterValue.length > 0;\n            }\n            return filterValue !== null;\n        });\n        const mergedRenderFilterRef = computed(() => {\n            var _a, _b;\n            return (((_b = (_a = mergedComponentPropsRef === null || mergedComponentPropsRef === void 0 ? void 0 : mergedComponentPropsRef.value) === null || _a === void 0 ? void 0 : _a.DataTable) === null || _b === void 0 ? void 0 : _b.renderFilter) ||\n                props.column.renderFilter);\n        });\n        function handleFilterChange(mergedFilterValue) {\n            const nextFilterState = createFilterState(filterStateRef.value, props.column.key, mergedFilterValue);\n            doUpdateFilters(nextFilterState, props.column);\n            if (paginationBehaviorOnFilterRef.value === 'first') {\n                doUpdatePage(1);\n            }\n        }\n        function handleFilterMenuCancel() {\n            showPopoverRef.value = false;\n        }\n        function handleFilterMenuConfirm() {\n            showPopoverRef.value = false;\n        }\n        return {\n            mergedTheme: mergedThemeRef,\n            mergedClsPrefix: mergedClsPrefixRef,\n            active: activeRef,\n            showPopover: showPopoverRef,\n            mergedRenderFilter: mergedRenderFilterRef,\n            filterMultiple: filterMultipleRef,\n            mergedFilterValue: mergedFilterValueRef,\n            filterMenuCssVars: filterMenuCssVarsRef,\n            handleFilterChange,\n            handleFilterMenuConfirm,\n            handleFilterMenuCancel\n        };\n    },\n    render() {\n        const { mergedTheme, mergedClsPrefix, handleFilterMenuCancel } = this;\n        return (h(NPopover, { show: this.showPopover, onUpdateShow: (v) => (this.showPopover = v), trigger: \"click\", theme: mergedTheme.peers.Popover, themeOverrides: mergedTheme.peerOverrides.Popover, placement: \"bottom\", style: { padding: 0 } }, {\n            trigger: () => {\n                const { mergedRenderFilter } = this;\n                if (mergedRenderFilter) {\n                    return (h(RenderFilter, { \"data-data-table-filter\": true, render: mergedRenderFilter, active: this.active, show: this.showPopover }));\n                }\n                const { renderFilterIcon } = this.column;\n                return (h(\"div\", { \"data-data-table-filter\": true, class: [\n                        `${mergedClsPrefix}-data-table-filter`,\n                        {\n                            [`${mergedClsPrefix}-data-table-filter--active`]: this.active,\n                            [`${mergedClsPrefix}-data-table-filter--show`]: this.showPopover\n                        }\n                    ] }, renderFilterIcon ? (renderFilterIcon({\n                    active: this.active,\n                    show: this.showPopover\n                })) : (h(NBaseIcon, { clsPrefix: mergedClsPrefix }, { default: () => h(FilterIcon, null) }))));\n            },\n            default: () => {\n                const { renderFilterMenu } = this.column;\n                return renderFilterMenu ? (renderFilterMenu({ hide: handleFilterMenuCancel })) : (h(NDataTableFilterMenu, { style: this.filterMenuCssVars, radioGroupName: String(this.column.key), multiple: this.filterMultiple, value: this.mergedFilterValue, options: this.options, column: this.column, onChange: this.handleFilterChange, onClear: this.handleFilterMenuCancel, onConfirm: this.handleFilterMenuConfirm }));\n            }\n        }));\n    }\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}