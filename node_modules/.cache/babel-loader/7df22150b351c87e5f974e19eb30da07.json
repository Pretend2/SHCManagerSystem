{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, reactive, inject } from 'vue';\nimport { useMessage, useDialog } from 'naive-ui';\nimport axios from 'axios';\nexport default (loadList => {\n  // 接收全局变量\n  const global = inject('global');\n  const message = useMessage();\n  const dialog = useDialog();\n  const leftSpin = ref(false); // 当前选中节点\n\n  const buildingNode = ref(null);\n  const unitNode = ref(null); // 楼栋 模态框\n\n  const buildingStatus = ref(false); // false 添加 true 修改\n\n  const buildingFormRef = ref(null);\n  const showBuildingModal = ref(false); // 模态框是否打开\n  // 表单校验\n\n  const buildingRules = {\n    id: {\n      required: true,\n      message: \"请输入楼栋编号\",\n      trigger: \"blur\"\n    },\n    name: {\n      required: true,\n      message: \"请输入楼栋名称\",\n      trigger: \"blur\"\n    },\n    area: {\n      required: true,\n      message: \"请输入建筑面积\",\n      trigger: \"blur\"\n    }\n  }; // 表单输入数据\n\n  const buildingValue = ref({\n    id: \"\",\n    name: \"\",\n    area: \"\",\n    remark: \"\"\n  }); // 表单提交事件\n\n  const buildingSubmit = e => {\n    e.preventDefault();\n    buildingFormRef.value?.validate(errors => {\n      if (!errors) {\n        // 校验通过\n        if (!buildingStatus.value) {// 添加\n        } else {// 删除\n        }\n      } else {// 校验不通过\n      }\n    });\n  }; // 楼栋信息\n\n\n  const buildingData = reactive([]);\n  /* \r\n  \r\n  [{\r\n      \"label\": \"1栋\",\r\n      \"type\": 0,\r\n      \"key\": \"403626\",\r\n      \"children\": [\r\n        {\r\n          \"label\": \"1单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362610\"\r\n        },\r\n        {\r\n          \"label\": \"2单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362611\"\r\n        },\r\n        {\r\n          \"label\": \"6单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362612\"\r\n        },\r\n        {\r\n          \"label\": \"12单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362613\"\r\n        }\r\n      ]\r\n    }, {\r\n      \"label\": \"2栋\",\r\n      \"type\": 0,\r\n      \"key\": \"403627\",\r\n      \"children\": [\r\n        {\r\n          \"label\": \"1单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362614\"\r\n        },\r\n        {\r\n          \"label\": \"2单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362615\"\r\n        },\r\n        {\r\n          \"label\": \"6单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362616\"\r\n        },\r\n        {\r\n          \"label\": \"12单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362617\"\r\n        }\r\n      ]\r\n    }, , {\r\n      \"label\": \"3栋\",\r\n      \"type\": 0,\r\n      \"key\": \"403628\",\r\n      \"children\": [\r\n        {\r\n          \"label\": \"1单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362618\"\r\n        },\r\n        {\r\n          \"label\": \"2单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362619\"\r\n        },\r\n        {\r\n          \"label\": \"6单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362620\"\r\n        },\r\n        {\r\n          \"label\": \"12单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362621\"\r\n        }\r\n      ]\r\n    }]\r\n  */\n  // 加载楼栋信息\n\n  leftSpin.value = true; // 加载楼栋信息\n\n  axios({\n    method: 'get',\n    url: '/api/getAllBuildings'\n  }).then(res => {\n    for (let building of res.data) {\n      const tempData = reactive({\n        \"id\": building.buildingNo,\n        \"label\": building.name,\n        \"type\": 0,\n        \"key\": \"L\" + building.id,\n        \"children\": []\n      });\n      axios({\n        method: 'get',\n        url: global.api + '/getAllByBuildingNoUnits/' + building.buildingNo\n      }).then(res => {\n        for (let unit of res.data) {\n          tempData.children.push({\n            \"id\": unit.utilNo,\n            \"label\": unit.utilNo + \"单元\",\n            \"type\": 1,\n            \"key\": \"D\" + unit.id,\n            \"building\": {\n              \"id\": building.buildingNo,\n              \"label\": building.name,\n              \"type\": 0,\n              \"key\": \"L\" + building.id\n            }\n          });\n        }\n\n        leftSpin.value = false;\n      }).catch(err => {\n        message.error('加载出现异常！' + err);\n        leftSpin.value = false;\n      });\n      buildingData.push(tempData);\n    }\n  }).catch(err => {\n    leftSpin.value = false;\n    message.error('数据加载异常！' + err, {\n      duration: 5000\n    });\n  }); // 楼栋节点点击事件\n\n  function nodeProps({\n    option\n  }) {\n    return {\n      onClick() {\n        if (option.type === 0) {\n          // 楼栋被点击\n          buildingNode.value = option;\n        } else if (option.type === 1) {\n          // 单元被点击\n          buildingNode.value = option.building;\n          unitNode.value = option;\n          loadList(option, 1);\n        }\n      }\n\n    };\n  } // 删除楼栋\n\n\n  const deleteBuilding = id => {\n    dialog.warning({\n      title: \"请确认您的操作!\",\n      content: \"确认是否删除!\",\n      positiveText: \"确认删除\",\n      negativeText: \"取消\",\n      onPositiveClick: () => {\n        message.success(\"确认删除 => \" + id);\n      }\n    });\n  };\n\n  return {\n    buildingStatus,\n    // 楼栋模态框状态\n    buildingFormRef,\n    // 楼栋模态框 Form 引用\n    showBuildingModal,\n    // 楼栋模态框是否显示\n    buildingRules,\n    // 楼栋模态框 Form 校验信息\n    buildingValue,\n    // 楼栋模态框 Form 参数\n    buildingData,\n    // 楼栋信息\n    leftSpin,\n    // 楼栋信息 Spin\n    buildingNode,\n    // 单前选中的楼栋节点\n    unitNode,\n    // 单前选中的单元节点\n    buildingSubmit,\n    // 楼栋 Form 提交事件\n    nodeProps,\n    // 楼栋信息节点选中事件\n    deleteBuilding // 删除楼栋事件\n\n  };\n});","map":{"version":3,"names":["ref","reactive","inject","useMessage","useDialog","axios","loadList","global","message","dialog","leftSpin","buildingNode","unitNode","buildingStatus","buildingFormRef","showBuildingModal","buildingRules","id","required","trigger","name","area","buildingValue","remark","buildingSubmit","e","preventDefault","value","validate","errors","buildingData","method","url","then","res","building","data","tempData","buildingNo","api","unit","children","push","utilNo","catch","err","error","duration","nodeProps","option","onClick","type","deleteBuilding","warning","title","content","positiveText","negativeText","onPositiveClick","success"],"sources":["E:/VCode/SHC社区管理系统/shc_community_manager_system/src/hook/real_estate/housingmanagement/buildingHook.js"],"sourcesContent":["import { ref, reactive, inject } from 'vue'\r\n\r\nimport { useMessage, useDialog } from 'naive-ui'\r\n\r\nimport axios from 'axios'\r\n\r\nexport default (loadList) => {\r\n\r\n  // 接收全局变量\r\n  const global = inject('global');\r\n\r\n  const message = useMessage();\r\n  const dialog = useDialog();\r\n\r\n  const leftSpin = ref(false)\r\n\r\n  // 当前选中节点\r\n  const buildingNode = ref(null);\r\n  const unitNode = ref(null);\r\n\r\n  // 楼栋 模态框\r\n  const buildingStatus = ref(false); // false 添加 true 修改\r\n  const buildingFormRef = ref(null);\r\n  const showBuildingModal = ref(false) // 模态框是否打开\r\n  // 表单校验\r\n  const buildingRules = {\r\n    id: {\r\n      required: true,\r\n      message: \"请输入楼栋编号\",\r\n      trigger: \"blur\"\r\n    },\r\n    name: {\r\n      required: true,\r\n      message: \"请输入楼栋名称\",\r\n      trigger: \"blur\"\r\n    },\r\n    area: {\r\n      required: true,\r\n      message: \"请输入建筑面积\",\r\n      trigger: \"blur\"\r\n    },\r\n  }\r\n\r\n  // 表单输入数据\r\n  const buildingValue = ref({\r\n    id: \"\",\r\n    name: \"\",\r\n    area: \"\",\r\n    remark: \"\",\r\n  })\r\n\r\n  // 表单提交事件\r\n  const buildingSubmit = (e) => {\r\n    e.preventDefault();\r\n    buildingFormRef.value?.validate((errors) => {\r\n      if (!errors) {\r\n        // 校验通过\r\n        if (!buildingStatus.value) { // 添加\r\n\r\n        } else { // 删除\r\n\r\n        }\r\n      } else {\r\n        // 校验不通过\r\n      }\r\n    });\r\n  }\r\n\r\n  // 楼栋信息\r\n  const buildingData = reactive([])\r\n\r\n  /* \r\n  \r\n  [{\r\n      \"label\": \"1栋\",\r\n      \"type\": 0,\r\n      \"key\": \"403626\",\r\n      \"children\": [\r\n        {\r\n          \"label\": \"1单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362610\"\r\n        },\r\n        {\r\n          \"label\": \"2单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362611\"\r\n        },\r\n        {\r\n          \"label\": \"6单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362612\"\r\n        },\r\n        {\r\n          \"label\": \"12单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362613\"\r\n        }\r\n      ]\r\n    }, {\r\n      \"label\": \"2栋\",\r\n      \"type\": 0,\r\n      \"key\": \"403627\",\r\n      \"children\": [\r\n        {\r\n          \"label\": \"1单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362614\"\r\n        },\r\n        {\r\n          \"label\": \"2单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362615\"\r\n        },\r\n        {\r\n          \"label\": \"6单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362616\"\r\n        },\r\n        {\r\n          \"label\": \"12单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362617\"\r\n        }\r\n      ]\r\n    }, , {\r\n      \"label\": \"3栋\",\r\n      \"type\": 0,\r\n      \"key\": \"403628\",\r\n      \"children\": [\r\n        {\r\n          \"label\": \"1单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362618\"\r\n        },\r\n        {\r\n          \"label\": \"2单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362619\"\r\n        },\r\n        {\r\n          \"label\": \"6单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362620\"\r\n        },\r\n        {\r\n          \"label\": \"12单元\",\r\n          \"type\": 1,\r\n          \"key\": \"40362621\"\r\n        }\r\n      ]\r\n    }]\r\n  */\r\n\r\n  // 加载楼栋信息\r\n  leftSpin.value = true\r\n  // 加载楼栋信息\r\n  axios({\r\n    method: 'get',\r\n    url: '/api/getAllBuildings',\r\n  }).then(res => {\r\n    for (let building of res.data) {\r\n      const tempData = reactive({\r\n        \"id\": building.buildingNo,\r\n        \"label\": building.name,\r\n        \"type\": 0,\r\n        \"key\": \"L\" + building.id,\r\n        \"children\": []\r\n      })\r\n\r\n      axios({\r\n        method: 'get',\r\n        url: global.api + '/getAllByBuildingNoUnits/' + building.buildingNo,\r\n      }).then(res => {\r\n        for (let unit of res.data) {\r\n          tempData.children.push({\r\n            \"id\": unit.utilNo,\r\n            \"label\": unit.utilNo + \"单元\",\r\n            \"type\": 1,\r\n            \"key\": \"D\" + unit.id,\r\n            \"building\": {\r\n              \"id\": building.buildingNo,\r\n              \"label\": building.name,\r\n              \"type\": 0,\r\n              \"key\": \"L\" + building.id\r\n            }\r\n          })\r\n        }\r\n        leftSpin.value = false\r\n      }).catch(err => {\r\n        message.error('加载出现异常！' + err)\r\n        leftSpin.value = false\r\n      })\r\n      buildingData.push(tempData);\r\n    }\r\n  }).catch(err => {\r\n    leftSpin.value = false\r\n    message.error('数据加载异常！' + err, { duration: 5000 })\r\n  })\r\n\r\n  // 楼栋节点点击事件\r\n  function nodeProps({ option }) {\r\n    return {\r\n      onClick() {\r\n        if (option.type === 0) { // 楼栋被点击\r\n          buildingNode.value = option\r\n        } else if (option.type === 1) { // 单元被点击\r\n          buildingNode.value = option.building\r\n          unitNode.value = option\r\n          loadList(option, 1);\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  // 删除楼栋\r\n  const deleteBuilding = (id) => {\r\n    dialog.warning({\r\n      title: \"请确认您的操作!\",\r\n      content: \"确认是否删除!\",\r\n      positiveText: \"确认删除\",\r\n      negativeText: \"取消\",\r\n      onPositiveClick: () => {\r\n        message.success(\"确认删除 => \" + id);\r\n      }\r\n    });\r\n  }\r\n\r\n  return {\r\n    buildingStatus, // 楼栋模态框状态\r\n    buildingFormRef, // 楼栋模态框 Form 引用\r\n    showBuildingModal, // 楼栋模态框是否显示\r\n    buildingRules, // 楼栋模态框 Form 校验信息\r\n    buildingValue, // 楼栋模态框 Form 参数\r\n    buildingData, // 楼栋信息\r\n    leftSpin, // 楼栋信息 Spin\r\n    buildingNode, // 单前选中的楼栋节点\r\n    unitNode, // 单前选中的单元节点\r\n    buildingSubmit, // 楼栋 Form 提交事件\r\n    nodeProps, // 楼栋信息节点选中事件\r\n    deleteBuilding, // 删除楼栋事件\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}