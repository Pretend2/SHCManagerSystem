{"ast":null,"code":"const __default__ = {\n  name: 'App'\n};\nimport { ref, provide, inject, watch } from 'vue';\nimport { NConfigProvider, NMessageProvider, darkTheme, NButton, NGlobalStyle, NLoadingBarProvider, zhCN, dateZhCN, NDialogProvider } from 'naive-ui'; // 引入自定义主题\n\nimport myTheme from './theme.js'; // 引入路由\n\nimport { useRouter } from \"vue-router\";\nimport axios from 'axios'; // 接收全局变量\n\nexport default /*#__PURE__*/Object.assign(__default__, {\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const global = inject('global');\n    const dark = ref(false); // 向后代组件传递数据\n\n    provide('dark', dark);\n    console.log(localStorage.getItem(\"dark\"));\n    watch(dark, (newValue, oldValue) => {\n      localStorage.setItem(\"dark\", dark.value);\n    }); // 获取路由对象\n\n    const router = useRouter(); // 前置守卫\n\n    router.beforeEach((to, from, next) => {\n      let path = null; // 设置网页标题\n\n      document.title = to.meta.title;\n\n      if (to.name === \"login\") {\n        localStorage.removeItem(\"user\");\n      } else {\n        const user = JSON.parse(localStorage.getItem(\"user\"));\n\n        if (!user) {\n          path = '/login';\n        } else {\n          axios({\n            url: global.api + '/checkToken',\n            headers: {\n              token: user.token\n            }\n          }).then(res => {\n            if (!res.data) {\n              path = '/login';\n            }\n          });\n        }\n      }\n\n      next(path);\n    });\n    /* \n    // 获取路由实例\n    const router = useRouter();\n    router.beforeEach((to, from, next) => {\n      document.title = to.meta.title\n      //loadingBar.start();\n      next();\n    });\n    \n    router.afterEach(() => {\n      //loadingBar.finish();\n    }); */\n\n    const __returned__ = {\n      global,\n      dark,\n      router,\n      ref,\n      provide,\n      inject,\n      watch,\n      NConfigProvider,\n      NMessageProvider,\n      darkTheme,\n      NButton,\n      NGlobalStyle,\n      NLoadingBarProvider,\n      zhCN,\n      dateZhCN,\n      NDialogProvider,\n      myTheme,\n      useRouter,\n      axios\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n});","map":{"version":3,"mappings":"AAkFA,oBAAe;EACbA,IAAI,EAAE;AADO,CAAf;AApEA,SAASC,GAAT,EAAcC,OAAd,EAAuBC,MAAvB,EAA+BC,KAA/B,QAA4C,KAA5C;AAEA,SACEC,eADF,EACmBC,gBADnB,EACqCC,SADrC,EACgDC,OADhD,EAEEC,YAFF,EAEgBC,mBAFhB,EAEqCC,IAFrC,EAE2CC,QAF3C,EAEqDC,eAFrD,QAGO,UAHP,C,CAKA;;AACA,OAAOC,OAAP,MAAoB,YAApB,C,CAEA;;AACA,SAASC,SAAT,QAA0B,YAA1B;AACA,OAAOC,KAAP,MAAkB,OAAlB,C,CAEA;;;;;;;IACA,MAAMC,MAAM,GAAGd,MAAM,CAAC,QAAD,CAArB;IAEA,MAAMe,IAAI,GAAGjB,GAAG,CAAC,KAAD,CAAhB,EACA;;IACAC,OAAO,CAAC,MAAD,EAASgB,IAAT,CAAP;IACAC,OAAO,CAACC,GAAR,CAAYC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAZ;IACAlB,KAAK,CAACc,IAAD,EAAM,CAACK,QAAD,EAAUC,QAAV,KAAuB;MAChCH,YAAY,CAACI,OAAb,CAAqB,MAArB,EAA4BP,IAAI,CAACQ,KAAjC;IACD,CAFI,CAAL,EAIA;;IACA,MAAMC,MAAM,GAAGZ,SAAS,EAAxB,EAEA;;IACAY,MAAM,CAACC,UAAP,CAAkB,CAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,KAAoB;MACpC,IAAIC,IAAI,GAAG,IAAX,CADoC,CAEpC;;MACAC,QAAQ,CAACC,KAAT,GAAiBL,EAAE,CAACM,IAAH,CAAQD,KAAzB;;MACA,IAAIL,EAAE,CAAC7B,IAAH,KAAY,OAAhB,EAAyB;QACvBqB,YAAY,CAACe,UAAb,CAAwB,MAAxB;MACD,CAFD,MAEO;QACL,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWlB,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAX,CAAb;;QACA,IAAI,CAACe,IAAL,EAAW;UACTL,IAAI,GAAG,QAAP;QACD,CAFD,MAEO;UACLhB,KAAK,CAAC;YACJwB,GAAG,EAAEvB,MAAM,CAACwB,GAAP,GAAa,aADd;YAEJC,OAAO,EAAE;cAAEC,KAAK,EAAEN,IAAI,CAACM;YAAd;UAFL,CAAD,CAAL,CAGGC,IAHH,CAGQC,GAAG,IAAI;YACb,IAAI,CAACA,GAAG,CAACC,IAAT,EAAe;cACbd,IAAI,GAAG,QAAP;YACD;UACF,CAPD;QAQD;MACF;;MACDD,IAAI,CAACC,IAAD,CAAJ;IACD,CAtBD;IAwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","names":["name","ref","provide","inject","watch","NConfigProvider","NMessageProvider","darkTheme","NButton","NGlobalStyle","NLoadingBarProvider","zhCN","dateZhCN","NDialogProvider","myTheme","useRouter","axios","global","dark","console","log","localStorage","getItem","newValue","oldValue","setItem","value","router","beforeEach","to","from","next","path","document","title","meta","removeItem","user","JSON","parse","url","api","headers","token","then","res","data"],"sources":["E:/VCode/SHC社区管理系统/shc_community_manager_system/src/App.vue"],"sourcesContent":["<template>\n  <n-config-provider :locale=\"zhCN\" :date-locale=\"dateZhCN\" :theme=\"dark ? darkTheme : null\" :theme-overrides=\"myTheme\">\n    <n-loading-bar-provider>\n      <n-dialog-provider>\n        <n-message-provider>\n          <router-view></router-view>\n        </n-message-provider>\n      </n-dialog-provider>\n    </n-loading-bar-provider>\n    <n-global-style />\n  </n-config-provider>\n</template>\n\n<script setup>\nimport { ref, provide, inject, watch } from 'vue'\n\nimport {\n  NConfigProvider, NMessageProvider, darkTheme, NButton,\n  NGlobalStyle, NLoadingBarProvider, zhCN, dateZhCN, NDialogProvider\n} from 'naive-ui'\n\n// 引入自定义主题\nimport myTheme from './theme.js'\n\n// 引入路由\nimport { useRouter } from \"vue-router\";\nimport axios from 'axios';\n\n// 接收全局变量\nconst global = inject('global');\n\nconst dark = ref(false)\n// 向后代组件传递数据\nprovide('dark', dark)\nconsole.log(localStorage.getItem(\"dark\"));\nwatch(dark,(newValue,oldValue) => {\n  localStorage.setItem(\"dark\",dark.value)\n})\n\n// 获取路由对象\nconst router = useRouter()\n\n// 前置守卫\nrouter.beforeEach((to, from, next) => {\n  let path = null\n  // 设置网页标题\n  document.title = to.meta.title\n  if (to.name === \"login\") {\n    localStorage.removeItem(\"user\")\n  } else {\n    const user = JSON.parse(localStorage.getItem(\"user\"))\n    if (!user) {\n      path = '/login'\n    } else {\n      axios({\n        url: global.api + '/checkToken',\n        headers: { token: user.token }\n      }).then(res => {\n        if (!res.data) {\n          path = '/login'\n        }\n      })\n    }\n  }\n  next(path)\n});\n\n/* \n// 获取路由实例\nconst router = useRouter();\nrouter.beforeEach((to, from, next) => {\n  document.title = to.meta.title\n  //loadingBar.start();\n  next();\n});\n\nrouter.afterEach(() => {\n  //loadingBar.finish();\n}); */\n\n</script>\n<script>\nexport default {\n  name: 'App',\n}\n\n</script>\n\n<style>\n\n</style>\n"]},"metadata":{},"sourceType":"module"}