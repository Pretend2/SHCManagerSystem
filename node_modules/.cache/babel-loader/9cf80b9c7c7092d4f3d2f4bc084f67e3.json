{"ast":null,"code":"const __default__ = {\n  name: 'OwnerMemberLayout'\n};\nimport { ref, inject } from 'vue'; // 引入 naive-ui 组件\n\nimport { NCard, NLayout, NLayoutSider, NLayoutFooter, NLayoutContent, NLayoutHeader, NGrid, NGridItem, NButton, NSpace, NIcon, NButtonGroup, NPagination, NTable, NEllipsis, NModal, NInputGroup, NInput, useMessage, useDialog, NSpin, NForm, NFormItem, NSelect } from 'naive-ui'; // 引入图标 \n\nimport { Add20Filled as AddIcon, Search16Filled as SearchIcon } from '@vicons/fluent'; // 引入 axios\n\nimport axios from 'axios'; // 引入工具包\n\nimport { mergeObject, createId } from '../../util/BaseUtil';\nimport QueryString from 'qs'; // 读取全局变量\n\nexport default /*#__PURE__*/Object.assign(__default__, {\n  setup(__props, {\n    expose\n  }) {\n    expose(); // 引入 vue \n\n    const global = inject(\"global\"); // 获取消息对戏\n\n    const message = useMessage(); // 获取弹窗对象\n\n    const dialog = useDialog(); // #region ===== 业主选择 =====\n    // 当前选中的业主\n\n    const ownerInfo = ref({\n      \"id\": null,\n      \"ownerNo\": null,\n      \"name\": null,\n      \"gender\": null,\n      \"age\": null,\n      \"phone\": null,\n      \"idCard\": null,\n      \"weCat\": null,\n      \"remark\": null,\n      \"isMember\": null,\n      \"memberNo\": null\n    }); // 选择业主模态框\n\n    const showSelectOwnerModel = ref(false); // 业主列表加载\n\n    const ownerLoading = ref(false); // 业主信息\n\n    const ownerData = ref([]); // 当前页码\n\n    const ownerPage = ref(1); // 总页数\n\n    const ownerPages = ref(1); // modal nameInput\n\n    const ownerNameValue = ref(null);\n    /**\r\n     * 打开模态框\r\n     */\n\n    function openSelectOwnerModel() {\n      showSelectOwnerModel.value = true;\n      findOwnerInfo();\n    } // 查询业主信息\n\n\n    function findOwnerInfo(more) {\n      const params = {\n        page: 1,\n        size: 6\n      };\n      mergeObject(params, more);\n      ownerLoading.value = true;\n      axios({\n        method: 'get',\n        url: global.api + '/getAllOwnerByOtherNo',\n        params\n      }).then(res => {\n        // 设置业主数据\n        ownerData.value = res.data.list; // 设置当前页码\n\n        ownerPage.value = res.data.pageNum; // 设置总页数\n\n        ownerPages.value = res.data.pages;\n      }).catch(err => {\n        message.error(\"业主列表加载出现异常！\" + err);\n      }).finally(() => {\n        ownerLoading.value = false;\n      });\n    }\n    /**\r\n     * 选中业主信息\r\n     */\n\n\n    function selectOwnerInfo(owner) {\n      showSelectOwnerModel.value = false;\n      ownerInfo.value = owner;\n      findOwnerMember(1); // 查询业主成员\n    }\n    /**\r\n     * 业主信息页码改变时触发\r\n     */\n\n\n    function ownerPageUpdate(page) {\n      findOwnerInfo({\n        name: ownerNameValue.value,\n        page\n      });\n    } // #endregion\n    // #region ===== 业主成员 =====\n\n\n    const ownerMemberStatus = ref(false); // false 添加 true 修改\n\n    const ownerMemberFormRef = ref(null); // 业主成员 Form 引用\n\n    const showOwnerMemberModal = ref(false); // 模态框是否打开\n    // 表单校验\n\n    const ownerMemberRules = {\n      user: {\n        name: {\n          required: true,\n          message: \"请输入姓名\",\n          trigger: \"blur\"\n        },\n        gender: {\n          required: true,\n          type: \"number\",\n          message: \"请选择性别\",\n          trigger: \"blur\"\n        },\n        age: {\n          required: true,\n          message: \"请输入年龄\",\n          trigger: \"blur\"\n        },\n        phone: {\n          required: true,\n          message: \"请输入手机号码\",\n          trigger: \"blur\"\n        }\n      }\n    }; // 表单输入数据\n\n    const ownerMemberformValue = ref({\n      user: {\n        name: \"\",\n        gender: null,\n        age: \"\",\n        idCard: \"\",\n        phone: \"\",\n        remark: \"\",\n        weCat: \"\",\n        isMember: 0\n      }\n    }); // 表单提交事件\n\n    const ownerMemberSubmit = e => {\n      e.preventDefault();\n      ownerMemberFormRef.value?.validate(errors => {\n        if (!errors) {\n          // 校验通过\n          if (!ownerMemberStatus.value) {\n            // 添加\n            addOwnerMember();\n          } else {// 修改\n          }\n        } else {// 校验不通过\n        }\n      });\n    }; // 业主添加加载\n\n\n    const ownerMemberModalLoading = ref(false); // 性别选择框数据\n\n    const ownerMemberGenderOptions = ref([{\n      label: \"男\",\n      value: 1\n    }, {\n      label: \"女\",\n      value: 0\n    }]);\n    /**\r\n     * 打开模态框\r\n     * @param {false 添加 true 修改} status\r\n     */\n\n    const openOwnerMemberModal = (status, item) => {\n      // 清空数据\n      ownerMemberformValue.value = {\n        user: {\n          name: \"\",\n          gender: null,\n          age: \"\",\n          idCard: \"\",\n          phone: \"\",\n          remark: \"\",\n          weCat: \"\",\n          isMember: 1\n        }\n      };\n\n      if (status) {\n        // 如果是修改则填充数据\n        ownerMemberformValue.value.user.name = item.name;\n        ownerMemberformValue.value.user.gender = item.gender;\n        ownerMemberformValue.value.user.age = item.age.toString();\n        ownerMemberformValue.value.user.idCard = item.idCard;\n        ownerMemberformValue.value.user.phone = item.phone;\n        ownerMemberformValue.value.user.remark = item.remark;\n        ownerMemberformValue.value.user.weCat = item.weCat;\n        ownerMemberformValue.value.user.isMember = item.isMember;\n      } // 打开模态框\n\n\n      showOwnerMemberModal.value = true;\n      ownerMemberStatus.value = status;\n    };\n    /**\r\n     * 添加业主成员\r\n     */\n\n\n    const addOwnerMember = () => {\n      ownerMemberModalLoading.value = true;\n      ownerMemberformValue.value.user.memberNo = ownerInfo.value.ownerNo;\n      ownerMemberformValue.value.user.ownerNo = createId();\n      axios({\n        method: 'post',\n        url: global.api + '/addMemberOwner',\n        data: QueryString.stringify(ownerMemberformValue.value.user)\n      }).then(res => {\n        if (res.data.success) {\n          message.success(\"添加成功！\");\n          findOwnerMember(ownerMemberPageNo.value); // 刷新业主成员列表\n\n          showOwnerMemberModal.value = false; // 关闭模态框\n        } else {\n          message.warning(\"添加失败！\");\n        }\n      }).catch(err => {\n        message.error(\"添加业主出现异常！\" + err);\n      }).finally(() => {\n        ownerMemberModalLoading.value = false;\n      });\n    }; // 业主成员信息\n\n\n    const ownerMemberData = ref([]); // 业主成员加载\n\n    const ownerMemberLoading = ref(false); // 当前页码\n\n    const ownerMemberPageNo = ref(1); // 总页数\n\n    const ownerMemberPages = ref(1);\n    /**\r\n     * 查询业主成员信息\r\n     */\n\n    const findOwnerMember = page => {\n      ownerMemberLoading.value = true;\n      axios({\n        method: 'get',\n        url: global.api + '/getMemberInfoByOwnerNo',\n        params: {\n          page,\n          size: global.pageSize,\n          ownerNo: ownerInfo.value.ownerNo\n        }\n      }).then(res => {\n        // 设置数据\n        ownerMemberData.value = res.data.list; // 设置当前页码\n\n        ownerMemberPageNo.value = res.data.pageNum; // 设置总页数\n\n        ownerMemberPages.value = res.data.pages;\n      }).catch(err => {\n        message.error('业主成员查询出现异常！' + err);\n      }).finally(() => {\n        ownerMemberLoading.value = false;\n      });\n    };\n    /**\r\n     * 业主成员页码发生变化时触发\r\n     */\n\n\n    const ownerMemberPageUpdate = page => {\n      findOwnerMember(page);\n    }; // #endregion\n\n\n    const __returned__ = {\n      global,\n      message,\n      dialog,\n      ownerInfo,\n      showSelectOwnerModel,\n      ownerLoading,\n      ownerData,\n      ownerPage,\n      ownerPages,\n      ownerNameValue,\n      openSelectOwnerModel,\n      findOwnerInfo,\n      selectOwnerInfo,\n      ownerPageUpdate,\n      ownerMemberStatus,\n      ownerMemberFormRef,\n      showOwnerMemberModal,\n      ownerMemberRules,\n      ownerMemberformValue,\n      ownerMemberSubmit,\n      ownerMemberModalLoading,\n      ownerMemberGenderOptions,\n      openOwnerMemberModal,\n      addOwnerMember,\n      ownerMemberData,\n      ownerMemberLoading,\n      ownerMemberPageNo,\n      ownerMemberPages,\n      findOwnerMember,\n      ownerMemberPageUpdate,\n      ref,\n      inject,\n      NCard,\n      NLayout,\n      NLayoutSider,\n      NLayoutFooter,\n      NLayoutContent,\n      NLayoutHeader,\n      NGrid,\n      NGridItem,\n      NButton,\n      NSpace,\n      NIcon,\n      NButtonGroup,\n      NPagination,\n      NTable,\n      NEllipsis,\n      NModal,\n      NInputGroup,\n      NInput,\n      useMessage,\n      useDialog,\n      NSpin,\n      NForm,\n      NFormItem,\n      NSelect,\n      AddIcon,\n      SearchIcon,\n      axios,\n      mergeObject,\n      createId,\n      QueryString\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n});","map":{"version":3,"mappings":"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","names":["name","ref","inject","NCard","NLayout","NLayoutSider","NLayoutFooter","NLayoutContent","NLayoutHeader","NGrid","NGridItem","NButton","NSpace","NIcon","NButtonGroup","NPagination","NTable","NEllipsis","NModal","NInputGroup","NInput","useMessage","useDialog","NSpin","NForm","NFormItem","NSelect","Add20Filled","AddIcon","Search16Filled","SearchIcon","axios","mergeObject","createId","QueryString","global","message","dialog","ownerInfo","showSelectOwnerModel","ownerLoading","ownerData","ownerPage","ownerPages","ownerNameValue","openSelectOwnerModel","value","findOwnerInfo","more","params","page","size","method","url","api","then","res","data","list","pageNum","pages","catch","err","error","finally","selectOwnerInfo","owner","findOwnerMember","ownerPageUpdate","ownerMemberStatus","ownerMemberFormRef","showOwnerMemberModal","ownerMemberRules","user","required","trigger","gender","type","age","phone","ownerMemberformValue","idCard","remark","weCat","isMember","ownerMemberSubmit","e","preventDefault","validate","errors","addOwnerMember","ownerMemberModalLoading","ownerMemberGenderOptions","label","openOwnerMemberModal","status","item","toString","memberNo","ownerNo","stringify","success","ownerMemberPageNo","warning","ownerMemberData","ownerMemberLoading","ownerMemberPages","pageSize","ownerMemberPageUpdate"],"sources":["E:/VCode/SHC社区管理系统/shc_community_manager_system/src/layout/real_estate/OwnerMemberLayout.vue"],"sourcesContent":["<template>\r\n    <div class=\"body\">\r\n        <n-card title=\"业主信息\">\r\n            <template #header-extra>\r\n                <n-space>\r\n                    <n-button @click=\"openSelectOwnerModel\" type=\"primary\">\r\n                        <template #icon>\r\n                            <n-icon>\r\n                                <search-icon />\r\n                            </n-icon>\r\n                        </template>\r\n                        选择业主\r\n                    </n-button>\r\n                    <n-button v-if=\"ownerInfo.id != null\" @click=\"openOwnerMemberModal(false)\" type=\"primary\">\r\n                        <template #icon>\r\n                            <n-icon>\r\n                                <add-icon />\r\n                            </n-icon>\r\n                        </template>\r\n                        添加成员\r\n                    </n-button>\r\n                </n-space>\r\n            </template>\r\n            <div class=\"user-info\">\r\n                <!-- <img class=\"photo\" src=\"../../assets/user/noPhoto.jpg\" /> -->\r\n                <n-grid style=\"margin-left: 16px;\" cols=\"1 400:2 600:3\">\r\n                    <n-grid-item>\r\n                        <div class=\"sub-info\">\r\n                            业主ID：{{ ownerInfo.ownerNo }}\r\n                        </div>\r\n                    </n-grid-item>\r\n                    <n-grid-item>\r\n                        <div class=\"sub-info\">\r\n                            名称：{{ ownerInfo.name }}\r\n                        </div>\r\n                    </n-grid-item>\r\n                    <n-grid-item>\r\n                        <div class=\"sub-info\">\r\n                            性别：{{ ownerInfo.gender === 1 ? '男' : ownerInfo.gender === 0 ? '女' : '' }}\r\n                        </div>\r\n                    </n-grid-item>\r\n                    <n-grid-item>\r\n                        <div class=\"sub-info\">\r\n                            年龄：{{ ownerInfo.age }}\r\n                        </div>\r\n                    </n-grid-item>\r\n                    <n-grid-item>\r\n                        <div class=\"sub-info\">\r\n                            身份证：{{ ownerInfo.idCard }}\r\n                        </div>\r\n                    </n-grid-item>\r\n                    <n-grid-item>\r\n                        <div class=\"sub-info\">\r\n                            联系方式：{{ ownerInfo.phone }}\r\n                        </div>\r\n                    </n-grid-item>\r\n                    <n-grid-item>\r\n                        <div class=\"sub-info\">\r\n                            微信：{{ ownerInfo.weCat }}\r\n                        </div>\r\n                    </n-grid-item>\r\n                    <n-grid-item>\r\n                        <div class=\"sub-info\">\r\n                            备注：{{ ownerInfo.remark }}\r\n                        </div>\r\n                    </n-grid-item>\r\n                </n-grid>\r\n            </div>\r\n        </n-card>\r\n\r\n        <n-spin :show=\"ownerMemberLoading\">\r\n            <n-table style=\"margin-top: 10px\" striped>\r\n                <thead>\r\n                    <tr>\r\n                        <th>成员ID</th>\r\n                        <th>名称</th>\r\n                        <th>性别</th>\r\n                        <th>年龄</th>\r\n                        <th>身份证</th>\r\n                        <th>电话</th>\r\n                        <th>备注</th>\r\n                        <th>微信</th>\r\n                        <th>操作</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody v-if=\"ownerMemberData.length <= 0\">\r\n                        <tr>\r\n                            <td colspan=\"9\" style=\"text-align:center;\">暂无数据</td>\r\n                        </tr>\r\n                    </tbody>\r\n                <tbody>\r\n                    <tr v-for=\"(item,index) in ownerMemberData\" :key=\"index\">\r\n                        <td>\r\n                            <n-ellipsis style=\"max-width: 160px\">\r\n                                {{item.ownerNo}}\r\n                            </n-ellipsis>\r\n                        </td>\r\n                        <td>{{item.name}}</td>\r\n                        <td>{{item.gender === 1 ? '男' : item.gender === 0 ? '女' : ''}}</td>\r\n                        <td>{{item.age}}</td>\r\n                        <td>{{item.idCard}}</td>\r\n                        <td>{{item.phone}}</td>\r\n                        <td>\r\n                            <n-ellipsis style=\"max-width: 100px\">\r\n                                {{item.remark}}\r\n                            </n-ellipsis>\r\n                        </td>\r\n                        <td>{{item.weCat}}</td>\r\n                        <td>\r\n                            <n-button-group size=\"large\">\r\n                                <n-button size=\"small\">修改</n-button>\r\n                                <n-button type=\"error\" size=\"small\" strong secondary>删除</n-button>\r\n                            </n-button-group>\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </n-table>\r\n\r\n            <div v-if=\"ownerMemberPages > 1\" style=\"display: flex;justify-content: center;align-items: center;margin-top: 10px;\">\r\n                <n-pagination @update:page=\"ownerMemberPageUpdate\" :page-count=\"ownerMemberPages\" />\r\n            </div>\r\n        </n-spin>\r\n\r\n        <!-- 业主信息模态框 -->\r\n        <n-modal :auto-focus=\"false\" v-model:show=\"showSelectOwnerModel\" class=\"custom-card\" preset=\"card\"\r\n            style=\"width: 800px\" title=\"选择业主\" transform-origin=\"center\" size=\"huge\" :bordered=\"false\"\r\n            :segmented=\"{ content: 'soft', footer: 'soft' }\">\r\n\r\n            <n-spin :show=\"ownerLoading\">\r\n\r\n                <div class=\"selectOwnerClass\">\r\n                    <n-input-group>\r\n                        <n-input v-model:value=\"ownerNameValue\" type=\"text\" placeholder=\"请输入业主姓名\" />\r\n                        <n-button @click=\"findOwnerInfo({ name: ownerNameValue })\" type=\"primary\">搜索</n-button>\r\n                    </n-input-group>\r\n                </div>\r\n\r\n                <n-table style=\"margin-top: 16px\" striped>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>名称</th>\r\n                            <th>性别</th>\r\n                            <th>年龄</th>\r\n                            <th>身份证</th>\r\n                            <th>电话</th>\r\n                            <th>操作</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody v-if=\"ownerData.length <= 0\">\r\n                        <tr>\r\n                            <td colspan=\"6\" style=\"text-align:center;\">暂无数据</td>\r\n                        </tr>\r\n                    </tbody>\r\n                    <tbody>\r\n                        <tr v-for=\"(item, index) in ownerData\" :key=\"index\">\r\n                            <td>\r\n                                <n-ellipsis style=\"max-width: 100px\">\r\n                                    {{ item.name }}\r\n                                </n-ellipsis>\r\n                            </td>\r\n                            <td>\r\n                                <n-ellipsis style=\"max-width: 100px\">\r\n                                    {{ item.gender === 1 ? '男' : '女' }}\r\n                                </n-ellipsis>\r\n                            </td>\r\n                            <td>\r\n                                <n-ellipsis style=\"max-width: 100px\">\r\n                                    {{ item.age }}\r\n                                </n-ellipsis>\r\n                            </td>\r\n                            <td>\r\n                                <n-ellipsis style=\"max-width: 160px\">\r\n                                    {{ item.idCard }}\r\n                                </n-ellipsis>\r\n                            </td>\r\n                            <td>\r\n                                <n-ellipsis style=\"max-width: 100px\">\r\n                                    {{ item.phone }}\r\n                                </n-ellipsis>\r\n                            </td>\r\n                            <td style=\"width: 60px\">\r\n                                <n-button-group size=\"large\">\r\n                                    <n-button @click=\"selectOwnerInfo(item)\" size=\"small\" type=\"primary\">选择</n-button>\r\n                                </n-button-group>\r\n                            </td>\r\n                        </tr>\r\n                    </tbody>\r\n                </n-table>\r\n\r\n                <div v-if=\"ownerPages > 1\"\r\n                    style=\"display: flex;justify-content: center;align-items: center;margin-top: 26px;\">\r\n                    <n-pagination @update:page=\"ownerPageUpdate\" :page-count=\"ownerPages\" />\r\n                </div>\r\n\r\n            </n-spin>\r\n\r\n\r\n            <template #footer>\r\n                <n-space justify=\"end\">\r\n                    <n-button @click=\"showSelectOwnerModel = false\">关闭</n-button>\r\n                </n-space>\r\n            </template>\r\n        </n-modal>\r\n\r\n        <!-- 业主成员信息模态框 -->\r\n        <n-modal :auto-focus=\"false\" v-model:show=\"showOwnerMemberModal\" class=\"custom-card\" preset=\"card\"\r\n            style=\"width: 800px\" :title=\"ownerMemberStatus ? '修改' : '添加' + '业主'\" transform-origin=\"center\" size=\"huge\"\r\n            :bordered=\"false\" :segmented=\"{ content: 'soft', footer: 'soft' }\">\r\n            <n-form ref=\"ownerMemberFormRef\" label-placement=\"left\" :label-width=\"80\" :model=\"ownerMemberformValue\"\r\n                :rules=\"ownerMemberRules\" size=\"medium\">\r\n                <n-grid cols=\"1 600:2\">\r\n                    <n-grid-item>\r\n                        <n-form-item label=\"姓名\" path=\"user.name\">\r\n                            <n-input v-model:value=\"ownerMemberformValue.user.name\" placeholder=\"输入姓名\" />\r\n                        </n-form-item>\r\n                        <n-form-item label=\"性别\" path=\"user.gender\">\r\n                            <n-select v-model:value=\"ownerMemberformValue.user.gender\" placeholder=\"输入性别\"\r\n                                :options=\"ownerMemberGenderOptions\" />\r\n                        </n-form-item>\r\n                        <n-form-item label=\"年龄\" path=\"user.age\">\r\n                            <n-input v-model:value=\"ownerMemberformValue.user.age\" placeholder=\"输入年龄\" />\r\n                        </n-form-item>\r\n                        <n-form-item label=\"身份证\">\r\n                            <n-input v-model:value=\"ownerMemberformValue.user.idCard\" placeholder=\"输入身份证\" />\r\n                        </n-form-item>\r\n                    </n-grid-item>\r\n                    <n-grid-item>\r\n                        <n-form-item label=\"手机\" path=\"user.phone\">\r\n                            <n-input v-model:value=\"ownerMemberformValue.user.phone\" placeholder=\"输入手机号码\" />\r\n                        </n-form-item>\r\n                        <n-form-item label=\"备注\">\r\n                            <n-input v-model:value=\"ownerMemberformValue.user.remark\" placeholder=\"输入备注\" />\r\n                        </n-form-item>\r\n                        <n-form-item label=\"微信\">\r\n                            <n-input v-model:value=\"ownerMemberformValue.user.weCat\" placeholder=\"输入微信\" />\r\n                        </n-form-item>\r\n                    </n-grid-item>\r\n                </n-grid>\r\n            </n-form>\r\n            <template #footer>\r\n                <n-space justify=\"end\">\r\n                    <n-button @click=\"showOwnerMemberModal = false\">取消</n-button>\r\n                    <n-button :loading=\"ownerMemberModalLoading\" type=\"primary\" attr-type=\"button\"\r\n                        @click=\"ownerMemberSubmit\">保存\r\n                    </n-button>\r\n                </n-space>\r\n            </template>\r\n        </n-modal>\r\n\r\n\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n// 引入 vue \r\nimport { ref, inject } from 'vue';\r\n// 引入 naive-ui 组件\r\nimport {\r\n    NCard, NLayout, NLayoutSider, NLayoutFooter,\r\n    NLayoutContent, NLayoutHeader, NGrid, NGridItem,\r\n    NButton, NSpace, NIcon, NButtonGroup, NPagination,\r\n    NTable, NEllipsis, NModal, NInputGroup, NInput,\r\n    useMessage, useDialog, NSpin, NForm, NFormItem,\r\n    NSelect\r\n} from 'naive-ui';\r\n// 引入图标 \r\nimport {\r\n    Add20Filled as AddIcon,\r\n    Search16Filled as SearchIcon\r\n} from '@vicons/fluent'\r\n// 引入 axios\r\nimport axios from 'axios'\r\n// 引入工具包\r\nimport { mergeObject, createId } from '../../util/BaseUtil'\r\nimport QueryString from 'qs'\r\n\r\n// 读取全局变量\r\nconst global = inject(\"global\")\r\n// 获取消息对戏\r\nconst message = useMessage()\r\n// 获取弹窗对象\r\nconst dialog = useDialog()\r\n\r\n// #region ===== 业主选择 =====\r\n// 当前选中的业主\r\nconst ownerInfo = ref({\r\n    \"id\": null,\r\n    \"ownerNo\": null,\r\n    \"name\": null,\r\n    \"gender\": null,\r\n    \"age\": null,\r\n    \"phone\": null,\r\n    \"idCard\": null,\r\n    \"weCat\": null,\r\n    \"remark\": null,\r\n    \"isMember\": null,\r\n    \"memberNo\": null\r\n})\r\n// 选择业主模态框\r\nconst showSelectOwnerModel = ref(false)\r\n// 业主列表加载\r\nconst ownerLoading = ref(false)\r\n// 业主信息\r\nconst ownerData = ref([])\r\n// 当前页码\r\nconst ownerPage = ref(1)\r\n// 总页数\r\nconst ownerPages = ref(1)\r\n// modal nameInput\r\nconst ownerNameValue = ref(null)\r\n/**\r\n * 打开模态框\r\n */\r\nfunction openSelectOwnerModel() {\r\n    showSelectOwnerModel.value = true\r\n    findOwnerInfo()\r\n}\r\n// 查询业主信息\r\nfunction findOwnerInfo(more) {\r\n    const params = {\r\n        page: 1,\r\n        size: 6,\r\n    }\r\n    mergeObject(params, more)\r\n    ownerLoading.value = true\r\n    axios({\r\n        method: 'get',\r\n        url: global.api + '/getAllOwnerByOtherNo',\r\n        params\r\n    }).then(res => {\r\n        // 设置业主数据\r\n        ownerData.value = res.data.list\r\n        // 设置当前页码\r\n        ownerPage.value = res.data.pageNum\r\n        // 设置总页数\r\n        ownerPages.value = res.data.pages\r\n    }).catch(err => {\r\n        message.error(\"业主列表加载出现异常！\" + err)\r\n    }).finally(() => {\r\n        ownerLoading.value = false\r\n    })\r\n}\r\n/**\r\n * 选中业主信息\r\n */\r\nfunction selectOwnerInfo(owner) {\r\n    showSelectOwnerModel.value = false\r\n    ownerInfo.value = owner\r\n    findOwnerMember(1) // 查询业主成员\r\n}\r\n/**\r\n * 业主信息页码改变时触发\r\n */\r\nfunction ownerPageUpdate(page) {\r\n    findOwnerInfo({\r\n        name: ownerNameValue.value,\r\n        page\r\n    })\r\n}\r\n// #endregion\r\n\r\n// #region ===== 业主成员 =====\r\nconst ownerMemberStatus = ref(false); // false 添加 true 修改\r\nconst ownerMemberFormRef = ref(null); // 业主成员 Form 引用\r\nconst showOwnerMemberModal = ref(false) // 模态框是否打开\r\n\r\n// 表单校验\r\nconst ownerMemberRules = {\r\n    user: {\r\n        name: {\r\n            required: true,\r\n            message: \"请输入姓名\",\r\n            trigger: \"blur\"\r\n        },\r\n        gender: {\r\n            required: true,\r\n            type: \"number\",\r\n            message: \"请选择性别\",\r\n            trigger: \"blur\"\r\n        },\r\n        age: {\r\n            required: true,\r\n            message: \"请输入年龄\",\r\n            trigger: \"blur\"\r\n        },\r\n        phone: {\r\n            required: true,\r\n            message: \"请输入手机号码\",\r\n            trigger: \"blur\"\r\n        },\r\n    },\r\n}\r\n// 表单输入数据\r\nconst ownerMemberformValue = ref({\r\n    user: {\r\n        name: \"\",\r\n        gender: null,\r\n        age: \"\",\r\n        idCard: \"\",\r\n        phone: \"\",\r\n        remark: \"\",\r\n        weCat: \"\",\r\n        isMember: 0\r\n    },\r\n})\r\n\r\n// 表单提交事件\r\nconst ownerMemberSubmit = (e) => {\r\n    e.preventDefault();\r\n    ownerMemberFormRef.value?.validate((errors) => {\r\n        if (!errors) {\r\n            // 校验通过\r\n            if (!ownerMemberStatus.value) { // 添加\r\n                addOwnerMember()\r\n            } else { // 修改\r\n\r\n            }\r\n        } else {\r\n            // 校验不通过\r\n        }\r\n    });\r\n}\r\n\r\n// 业主添加加载\r\nconst ownerMemberModalLoading = ref(false)\r\n\r\n// 性别选择框数据\r\nconst ownerMemberGenderOptions = ref([\r\n    {\r\n        label: \"男\",\r\n        value: 1\r\n    },\r\n    {\r\n        label: \"女\",\r\n        value: 0\r\n    }\r\n])\r\n\r\n/**\r\n * 打开模态框\r\n * @param {false 添加 true 修改} status\r\n */\r\nconst openOwnerMemberModal = (status, item) => {\r\n    // 清空数据\r\n    ownerMemberformValue.value = {\r\n        user: {\r\n            name: \"\",\r\n            gender: null,\r\n            age: \"\",\r\n            idCard: \"\",\r\n            phone: \"\",\r\n            remark: \"\",\r\n            weCat: \"\",\r\n            isMember: 1\r\n        },\r\n    }\r\n    if (status) { // 如果是修改则填充数据\r\n        ownerMemberformValue.value.user.name = item.name\r\n        ownerMemberformValue.value.user.gender = item.gender\r\n        ownerMemberformValue.value.user.age = item.age.toString()\r\n        ownerMemberformValue.value.user.idCard = item.idCard\r\n        ownerMemberformValue.value.user.phone = item.phone\r\n        ownerMemberformValue.value.user.remark = item.remark\r\n        ownerMemberformValue.value.user.weCat = item.weCat\r\n        ownerMemberformValue.value.user.isMember = item.isMember\r\n    }\r\n    // 打开模态框\r\n    showOwnerMemberModal.value = true;\r\n    ownerMemberStatus.value = status\r\n}\r\n\r\n/**\r\n * 添加业主成员\r\n */\r\nconst addOwnerMember = () => {\r\n    ownerMemberModalLoading.value = true\r\n    ownerMemberformValue.value.user.memberNo = ownerInfo.value.ownerNo\r\n    ownerMemberformValue.value.user.ownerNo = createId()\r\n    axios({\r\n        method: 'post',\r\n        url: global.api + '/addMemberOwner',\r\n        data: QueryString.stringify(ownerMemberformValue.value.user)\r\n    }).then(res => {\r\n        if (res.data.success) {\r\n            message.success(\"添加成功！\")\r\n            findOwnerMember(ownerMemberPageNo.value) // 刷新业主成员列表\r\n            showOwnerMemberModal.value = false // 关闭模态框\r\n        } else {\r\n            message.warning(\"添加失败！\")\r\n        }\r\n    }).catch(err => {\r\n        message.error(\"添加业主出现异常！\" + err)\r\n    }).finally(() => {\r\n        ownerMemberModalLoading.value = false\r\n    })\r\n}\r\n\r\n// 业主成员信息\r\nconst ownerMemberData = ref([])\r\n// 业主成员加载\r\nconst ownerMemberLoading = ref(false)\r\n// 当前页码\r\nconst ownerMemberPageNo = ref(1)\r\n// 总页数\r\nconst ownerMemberPages = ref(1)\r\n/**\r\n * 查询业主成员信息\r\n */\r\nconst findOwnerMember = (page) => {\r\n    ownerMemberLoading.value = true\r\n    axios({\r\n        method: 'get',\r\n        url: global.api + '/getMemberInfoByOwnerNo',\r\n        params: {\r\n            page,\r\n            size: global.pageSize,\r\n            ownerNo: ownerInfo.value.ownerNo\r\n        }\r\n    }).then(res => {\r\n        // 设置数据\r\n        ownerMemberData.value = res.data.list\r\n        // 设置当前页码\r\n        ownerMemberPageNo.value = res.data.pageNum\r\n        // 设置总页数\r\n        ownerMemberPages.value = res.data.pages\r\n    }).catch(err => {\r\n        message.error('业主成员查询出现异常！' + err)\r\n    }).finally(() => {\r\n        ownerMemberLoading.value = false\r\n    })\r\n}\r\n\r\n/**\r\n * 业主成员页码发生变化时触发\r\n */\r\nconst ownerMemberPageUpdate = (page) => {\r\n    findOwnerMember(page)\r\n}\r\n\r\n// #endregion\r\n\r\n\r\n</script>\r\n<script>\r\nexport default {\r\n    name: 'OwnerMemberLayout'\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.body {\r\n    padding: 10px;\r\n}\r\n\r\n.photo {\r\n    width: 120px;\r\n    height: 140px;\r\n    object-fit: cover;\r\n}\r\n\r\n.user-info {\r\n    display: flex;\r\n    flex-direction: row;\r\n}\r\n\r\n.sub-info {\r\n    display: flex;\r\n    align-items: center;\r\n    height: 100%;\r\n}\r\n\r\n.selectOwnerClass {\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: right;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}