{"ast":null,"code":"/* eslint-disable @typescript-eslint/strict-boolean-expressions */\nimport { defineComponent, renderSlot, h, onMounted, ref, nextTick } from 'vue';\nimport { useSsrAdapter } from '@css-render/vue3-ssr';\nimport { c, cssrAnchorMetaName } from '../../shared';\nconst hiddenAttr = 'v-hidden';\nconst style = c('[v-hidden]', {\n  display: 'none!important'\n});\nexport default defineComponent({\n  name: 'Overflow',\n  props: {\n    getCounter: Function,\n    getTail: Function,\n    updateCounter: Function,\n    onUpdateOverflow: Function\n  },\n\n  setup(props, {\n    slots\n  }) {\n    const selfRef = ref(null);\n    const counterRef = ref(null);\n\n    function deriveCounter() {\n      const {\n        value: self\n      } = selfRef;\n      const {\n        getCounter,\n        getTail\n      } = props;\n      let counter;\n      if (getCounter !== undefined) counter = getCounter();else {\n        counter = counterRef.value;\n      }\n      if (!self || !counter) return;\n\n      if (counter.hasAttribute(hiddenAttr)) {\n        counter.removeAttribute(hiddenAttr);\n      }\n\n      const {\n        children\n      } = self;\n      const containerWidth = self.offsetWidth;\n      const childWidths = [];\n      const tail = slots.tail ? getTail === null || getTail === void 0 ? void 0 : getTail() : null;\n      let childWidthSum = tail ? tail.offsetWidth : 0;\n      let overflow = false;\n      const len = self.children.length - (slots.tail ? 1 : 0);\n\n      for (let i = 0; i < len - 1; ++i) {\n        if (i < 0) continue;\n        const child = children[i];\n\n        if (overflow) {\n          if (!child.hasAttribute(hiddenAttr)) {\n            child.setAttribute(hiddenAttr, '');\n          }\n\n          continue;\n        } else if (child.hasAttribute(hiddenAttr)) {\n          child.removeAttribute(hiddenAttr);\n        }\n\n        const childWidth = child.offsetWidth;\n        childWidthSum += childWidth;\n        childWidths[i] = childWidth;\n\n        if (childWidthSum > containerWidth) {\n          const {\n            updateCounter\n          } = props;\n\n          for (let j = i; j >= 0; --j) {\n            const restCount = len - 1 - j;\n\n            if (updateCounter !== undefined) {\n              updateCounter(restCount);\n            } else {\n              counter.textContent = `${restCount}`;\n            }\n\n            const counterWidth = counter.offsetWidth;\n            childWidthSum -= childWidths[j];\n\n            if (childWidthSum + counterWidth <= containerWidth || j === 0) {\n              overflow = true;\n              i = j - 1;\n\n              if (tail) {\n                // tail too long or 1st element too long\n                // we only consider tail now\n                if (i === -1) {\n                  tail.style.maxWidth = `${containerWidth - counterWidth}px`;\n                  tail.style.boxSizing = 'border-box';\n                } else {\n                  tail.style.maxWidth = '';\n                }\n              }\n\n              break;\n            }\n          }\n        }\n      }\n\n      const {\n        onUpdateOverflow\n      } = props;\n\n      if (!overflow) {\n        if (onUpdateOverflow !== undefined) {\n          onUpdateOverflow(false);\n        }\n\n        counter.setAttribute(hiddenAttr, '');\n      } else {\n        if (onUpdateOverflow !== undefined) {\n          onUpdateOverflow(true);\n        }\n      }\n    }\n\n    const ssrAdapter = useSsrAdapter();\n    style.mount({\n      id: 'vueuc/overflow',\n      head: true,\n      anchorMetaName: cssrAnchorMetaName,\n      ssr: ssrAdapter\n    });\n    onMounted(deriveCounter); // besides onMounted, other case should be manually triggered, or we shoud watch items\n\n    return {\n      selfRef,\n      counterRef,\n      sync: deriveCounter\n    };\n  },\n\n  render() {\n    const {\n      $slots\n    } = this; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n    nextTick(this.sync); // It shouldn't have border\n\n    return h('div', {\n      class: 'v-overflow',\n      ref: 'selfRef'\n    }, [renderSlot($slots, 'default'), // $slots.counter should only has 1 element\n    $slots.counter ? $slots.counter() : h('span', {\n      style: {\n        display: 'inline-block'\n      },\n      ref: 'counterRef'\n    }), // $slots.tail should only has 1 element\n    $slots.tail ? $slots.tail() : null]);\n  }\n\n});","map":{"version":3,"names":["defineComponent","renderSlot","h","onMounted","ref","nextTick","useSsrAdapter","c","cssrAnchorMetaName","hiddenAttr","style","display","name","props","getCounter","Function","getTail","updateCounter","onUpdateOverflow","setup","slots","selfRef","counterRef","deriveCounter","value","self","counter","undefined","hasAttribute","removeAttribute","children","containerWidth","offsetWidth","childWidths","tail","childWidthSum","overflow","len","length","i","child","setAttribute","childWidth","j","restCount","textContent","counterWidth","maxWidth","boxSizing","ssrAdapter","mount","id","head","anchorMetaName","ssr","sync","render","$slots","class"],"sources":["E:/VCode/SHC社区管理系统/shc_community_manager_system/node_modules/vueuc/es/overflow/src/index.js"],"sourcesContent":["/* eslint-disable @typescript-eslint/strict-boolean-expressions */\nimport { defineComponent, renderSlot, h, onMounted, ref, nextTick } from 'vue';\nimport { useSsrAdapter } from '@css-render/vue3-ssr';\nimport { c, cssrAnchorMetaName } from '../../shared';\nconst hiddenAttr = 'v-hidden';\nconst style = c('[v-hidden]', {\n    display: 'none!important'\n});\nexport default defineComponent({\n    name: 'Overflow',\n    props: {\n        getCounter: Function,\n        getTail: Function,\n        updateCounter: Function,\n        onUpdateOverflow: Function\n    },\n    setup(props, { slots }) {\n        const selfRef = ref(null);\n        const counterRef = ref(null);\n        function deriveCounter() {\n            const { value: self } = selfRef;\n            const { getCounter, getTail } = props;\n            let counter;\n            if (getCounter !== undefined)\n                counter = getCounter();\n            else {\n                counter = counterRef.value;\n            }\n            if (!self || !counter)\n                return;\n            if (counter.hasAttribute(hiddenAttr)) {\n                counter.removeAttribute(hiddenAttr);\n            }\n            const { children } = self;\n            const containerWidth = self.offsetWidth;\n            const childWidths = [];\n            const tail = slots.tail ? getTail === null || getTail === void 0 ? void 0 : getTail() : null;\n            let childWidthSum = tail ? tail.offsetWidth : 0;\n            let overflow = false;\n            const len = self.children.length - (slots.tail ? 1 : 0);\n            for (let i = 0; i < len - 1; ++i) {\n                if (i < 0)\n                    continue;\n                const child = children[i];\n                if (overflow) {\n                    if (!child.hasAttribute(hiddenAttr)) {\n                        child.setAttribute(hiddenAttr, '');\n                    }\n                    continue;\n                }\n                else if (child.hasAttribute(hiddenAttr)) {\n                    child.removeAttribute(hiddenAttr);\n                }\n                const childWidth = child.offsetWidth;\n                childWidthSum += childWidth;\n                childWidths[i] = childWidth;\n                if (childWidthSum > containerWidth) {\n                    const { updateCounter } = props;\n                    for (let j = i; j >= 0; --j) {\n                        const restCount = len - 1 - j;\n                        if (updateCounter !== undefined) {\n                            updateCounter(restCount);\n                        }\n                        else {\n                            counter.textContent = `${restCount}`;\n                        }\n                        const counterWidth = counter.offsetWidth;\n                        childWidthSum -= childWidths[j];\n                        if (childWidthSum + counterWidth <= containerWidth || j === 0) {\n                            overflow = true;\n                            i = j - 1;\n                            if (tail) {\n                                // tail too long or 1st element too long\n                                // we only consider tail now\n                                if (i === -1) {\n                                    tail.style.maxWidth = `${containerWidth - counterWidth}px`;\n                                    tail.style.boxSizing = 'border-box';\n                                }\n                                else {\n                                    tail.style.maxWidth = '';\n                                }\n                            }\n                            break;\n                        }\n                    }\n                }\n            }\n            const { onUpdateOverflow } = props;\n            if (!overflow) {\n                if (onUpdateOverflow !== undefined) {\n                    onUpdateOverflow(false);\n                }\n                counter.setAttribute(hiddenAttr, '');\n            }\n            else {\n                if (onUpdateOverflow !== undefined) {\n                    onUpdateOverflow(true);\n                }\n            }\n        }\n        const ssrAdapter = useSsrAdapter();\n        style.mount({\n            id: 'vueuc/overflow',\n            head: true,\n            anchorMetaName: cssrAnchorMetaName,\n            ssr: ssrAdapter\n        });\n        onMounted(deriveCounter);\n        // besides onMounted, other case should be manually triggered, or we shoud watch items\n        return {\n            selfRef,\n            counterRef,\n            sync: deriveCounter\n        };\n    },\n    render() {\n        const { $slots } = this;\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        nextTick(this.sync);\n        // It shouldn't have border\n        return h('div', {\n            class: 'v-overflow',\n            ref: 'selfRef'\n        }, [\n            renderSlot($slots, 'default'),\n            // $slots.counter should only has 1 element\n            $slots.counter\n                ? $slots.counter()\n                : h('span', {\n                    style: {\n                        display: 'inline-block'\n                    },\n                    ref: 'counterRef'\n                }),\n            // $slots.tail should only has 1 element\n            $slots.tail ? $slots.tail() : null\n        ]);\n    }\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}