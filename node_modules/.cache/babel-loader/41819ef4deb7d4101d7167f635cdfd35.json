{"ast":null,"code":"import { ref, inject, watch } from 'vue';\nimport { useMessage, useDialog } from 'naive-ui';\nimport QueryString from 'qs';\nimport axios from 'axios';\nexport default ((buildingNode, loadBuilding, unitNode) => {\n  // 接收全局变量\n  const global = inject(\"global\");\n  const message = useMessage();\n  const dialog = useDialog(); // 单元 模态框\n\n  const apartmentStatus = ref(false); // false 添加 true 修改\n\n  const apartmentFormRef = ref(null);\n  const showApartmentModal = ref(false); // 模态框是否打开\n  // 提交按钮加载\n\n  const apartmentSubmitLoading = ref(false); // 表单校验\n\n  const apartmentRules = {\n    id: {\n      required: true,\n      message: \"请输入单元编号\",\n      trigger: \"blur\"\n    },\n    totalNumberOfLayers: {\n      type: \"number\",\n      required: true,\n      message: \"请输入总层数\",\n      trigger: \"blur\"\n    }\n  }; // 表单输入数据\n\n  const apartmentValue = ref({\n    id: \"\",\n    totalNumberOfLayers: null,\n    elevator: false,\n    remark: \"\"\n  }); // 表单提交事件\n\n  const apartmentSubmit = e => {\n    e.preventDefault();\n    apartmentFormRef.value?.validate(errors => {\n      if (!errors) {\n        // 校验通过\n        if (!apartmentStatus.value) {\n          // 添加\n          addApartment();\n        } else {\n          // 修改\n          updateApartment();\n        }\n      } else {// 校验不通过\n      }\n    });\n  };\n\n  watch(showApartmentModal, (newValue, oldValue) => {\n    if (newValue) {\n      apartmentValue.value = {\n        id: \"\",\n        totalNumberOfLayers: null,\n        elevator: false,\n        remark: \"\"\n      };\n\n      if (buildingNode.value != null && apartmentStatus.value) {\n        // 修改\n        if (unitNode.value != null) {\n          const unit = unitNode.value;\n          apartmentValue.value = {\n            id: unit.id,\n            totalNumberOfLayers: unit.totalNumberOfLayers,\n            elevator: unit.elevator,\n            remark: unit.remark,\n            key: unitNode.value.key.substring(1)\n          };\n        } else {\n          message.warning(\"请先选择单元！\");\n          showApartmentModal.value = false;\n        }\n      } else if (buildingNode.value != null) {// 添加\n      } else {\n        message.warning(\"请先选择楼栋！\");\n        showApartmentModal.value = false;\n      }\n    }\n  }); // 删除单元\n\n  const deleteApartment = () => {\n    const unit = unitNode.value;\n\n    if (unit != null) {\n      dialog.warning({\n        title: \"请确认您的操作!\",\n        content: \"确认是否删除\" + unit.label + \"!\",\n        positiveText: \"确认删除\",\n        negativeText: \"取消\",\n        onPositiveClick: () => {\n          message.success(\"确认删除 => \" + unit.key);\n        }\n      });\n    } else {\n      message.warning(\"请先选择单元！\");\n    }\n  }; // 添加单元\n\n\n  const addApartment = () => {\n    apartmentSubmitLoading.value = true;\n    axios({\n      method: 'post',\n      url: global.api + '/addUnit',\n      data: QueryString.stringify({\n        buildingNo: unitNode.value.building.id,\n        utilNo: apartmentValue.value.id,\n        totalFloors: apartmentValue.value.totalNumberOfLayers,\n        elevator: apartmentValue.value.elevator ? 1 : 0,\n        remark: apartmentValue.value.remark\n      })\n    }).then(res => {\n      if (res.data.success) {\n        message.success(\"添加成功！\");\n        loadBuilding();\n        showApartmentModal.value = false;\n      } else {\n        message.warning(\"添加失败！\");\n      }\n    }).catch(err => {\n      message.error(\"添加出现异常！\" + err);\n    }).finally(() => {\n      apartmentSubmitLoading.value = false;\n    });\n  }; // 修改单元\n\n\n  const updateApartment = () => {\n    apartmentSubmitLoading.value = true;\n    axios({\n      method: 'put',\n      url: global.api + '/updateUnit',\n      headers: {\n        'Content-Type': 'application/json;charset=UTF-8'\n      },\n      data: {\n        id: apartmentValue.value.key,\n        buildingNo: unitNode.value.building.id,\n        utilNo: apartmentValue.value.id,\n        totalFloors: apartmentValue.value.totalNumberOfLayers,\n        elevator: apartmentValue.value.elevator ? 1 : 0,\n        remark: apartmentValue.value.remark\n      }\n    }).then(res => {\n      if (res.data.data.updateStatus) {\n        message.success(\"修改成功！\");\n        loadBuilding();\n        unitNode.value = null;\n        showApartmentModal.value = false;\n      }\n    }).catch(err => {\n      message.error(\"修改出现异常！\" + err);\n    }).finally(() => {\n      apartmentSubmitLoading.value = false;\n    });\n  };\n\n  return {\n    apartmentStatus,\n    // 单元模态框状态\n    apartmentFormRef,\n    // 单元模态框 Form 引用\n    showApartmentModal,\n    // 显示单元模态框\n    apartmentRules,\n    // 单元模态框 Form 校验数据\n    apartmentValue,\n    // 单元模态框 Form 参数\n    apartmentSubmitLoading,\n    // 单元提交加载\n    apartmentSubmit,\n    // 单元模态框 Form 提交事件\n    deleteApartment // 删除单元点击事件\n\n  };\n});","map":{"version":3,"names":["ref","inject","watch","useMessage","useDialog","QueryString","axios","buildingNode","loadBuilding","unitNode","global","message","dialog","apartmentStatus","apartmentFormRef","showApartmentModal","apartmentSubmitLoading","apartmentRules","id","required","trigger","totalNumberOfLayers","type","apartmentValue","elevator","remark","apartmentSubmit","e","preventDefault","value","validate","errors","addApartment","updateApartment","newValue","oldValue","unit","key","substring","warning","deleteApartment","title","content","label","positiveText","negativeText","onPositiveClick","success","method","url","api","data","stringify","buildingNo","building","utilNo","totalFloors","then","res","catch","err","error","finally","headers","updateStatus"],"sources":["E:/VCode/SHC社区管理系统/shc_community_manager_system/src/hook/real_estate/housingmanagement/apartmentHook.js"],"sourcesContent":["import { ref, inject, watch } from 'vue'\r\n\r\nimport { useMessage, useDialog } from 'naive-ui'\r\n\r\nimport QueryString from 'qs'\r\n\r\nimport axios from 'axios'\r\n\r\nexport default (buildingNode, loadBuilding, unitNode) => {\r\n\r\n    // 接收全局变量\r\n    const global = inject(\"global\")\r\n\r\n    const message = useMessage();\r\n    const dialog = useDialog();\r\n\r\n    // 单元 模态框\r\n    const apartmentStatus = ref(false); // false 添加 true 修改\r\n    const apartmentFormRef = ref(null);\r\n    const showApartmentModal = ref(false) // 模态框是否打开\r\n\r\n    // 提交按钮加载\r\n    const apartmentSubmitLoading = ref(false);\r\n\r\n    // 表单校验\r\n    const apartmentRules = {\r\n        id: {\r\n            required: true,\r\n            message: \"请输入单元编号\",\r\n            trigger: \"blur\"\r\n        },\r\n        totalNumberOfLayers: {\r\n            type: \"number\",\r\n            required: true,\r\n            message: \"请输入总层数\",\r\n            trigger: \"blur\"\r\n        }\r\n    }\r\n\r\n    // 表单输入数据\r\n    const apartmentValue = ref({\r\n        id: \"\",\r\n        totalNumberOfLayers: null,\r\n        elevator: false,\r\n        remark: \"\"\r\n    })\r\n\r\n    // 表单提交事件\r\n    const apartmentSubmit = (e) => {\r\n        e.preventDefault();\r\n        apartmentFormRef.value?.validate((errors) => {\r\n            if (!errors) {\r\n                // 校验通过\r\n                if (!apartmentStatus.value) { // 添加\r\n                    addApartment()\r\n                } else { // 修改\r\n                    updateApartment();\r\n                }\r\n            } else {\r\n                // 校验不通过\r\n            }\r\n        });\r\n    }\r\n\r\n    watch(showApartmentModal, (newValue, oldValue) => {\r\n        if (newValue) {\r\n            apartmentValue.value = {\r\n                id: \"\",\r\n                totalNumberOfLayers: null,\r\n                elevator: false,\r\n                remark: \"\"\r\n            }\r\n            if (buildingNode.value != null && apartmentStatus.value) { // 修改\r\n                if (unitNode.value != null) {\r\n                    const unit = unitNode.value;\r\n                    apartmentValue.value = {\r\n                        id: unit.id,\r\n                        totalNumberOfLayers: unit.totalNumberOfLayers,\r\n                        elevator: unit.elevator,\r\n                        remark: unit.remark,\r\n                        key: unitNode.value.key.substring(1),\r\n                    }\r\n                } else {\r\n                    message.warning(\"请先选择单元！\")\r\n                    showApartmentModal.value = false\r\n                }\r\n            } else if (buildingNode.value != null) { // 添加\r\n\r\n            } else {\r\n                message.warning(\"请先选择楼栋！\")\r\n                showApartmentModal.value = false\r\n            }\r\n        }\r\n    })\r\n\r\n    // 删除单元\r\n    const deleteApartment = () => {\r\n        const unit = unitNode.value\r\n        if (unit != null) {\r\n            dialog.warning({\r\n                title: \"请确认您的操作!\",\r\n                content: \"确认是否删除\" + unit.label + \"!\",\r\n                positiveText: \"确认删除\",\r\n                negativeText: \"取消\",\r\n                onPositiveClick: () => {\r\n                    message.success(\"确认删除 => \" + unit.key);\r\n                }\r\n            });\r\n        } else {\r\n            message.warning(\"请先选择单元！\")\r\n        }\r\n    }\r\n\r\n    // 添加单元\r\n    const addApartment = () => {\r\n        apartmentSubmitLoading.value = true\r\n        axios({\r\n            method: 'post',\r\n            url: global.api + '/addUnit',\r\n            data: QueryString.stringify({\r\n                buildingNo: unitNode.value.building.id,\r\n                utilNo: apartmentValue.value.id,\r\n                totalFloors: apartmentValue.value.totalNumberOfLayers,\r\n                elevator: apartmentValue.value.elevator ? 1 : 0,\r\n                remark: apartmentValue.value.remark,\r\n            })\r\n        }).then(res => {\r\n            if (res.data.success) {\r\n                message.success(\"添加成功！\")\r\n                loadBuilding();\r\n                showApartmentModal.value = false\r\n            } else {\r\n                message.warning(\"添加失败！\")\r\n            }\r\n        }).catch(err => {\r\n            message.error(\"添加出现异常！\" + err)\r\n        }).finally(() => {\r\n            apartmentSubmitLoading.value = false\r\n        })\r\n    }\r\n\r\n    // 修改单元\r\n    const updateApartment = () => {\r\n        apartmentSubmitLoading.value = true\r\n        axios({\r\n            method: 'put',\r\n            url: global.api + '/updateUnit',\r\n            headers: {\r\n                'Content-Type': 'application/json;charset=UTF-8'\r\n            },\r\n            data: {\r\n                id: apartmentValue.value.key,\r\n                buildingNo: unitNode.value.building.id,\r\n                utilNo: apartmentValue.value.id,\r\n                totalFloors: apartmentValue.value.totalNumberOfLayers,\r\n                elevator: apartmentValue.value.elevator ? 1 : 0,\r\n                remark: apartmentValue.value.remark\r\n            }\r\n        }).then(res => {\r\n            if (res.data.data.updateStatus) {\r\n                message.success(\"修改成功！\");\r\n                loadBuilding();\r\n                unitNode.value = null\r\n                showApartmentModal.value = false\r\n            }\r\n        }).catch(err => {\r\n            message.error(\"修改出现异常！\" + err)\r\n        }).finally(() => {\r\n            apartmentSubmitLoading.value = false\r\n        })\r\n    }\r\n\r\n    return {\r\n        apartmentStatus, // 单元模态框状态\r\n        apartmentFormRef, // 单元模态框 Form 引用\r\n        showApartmentModal, // 显示单元模态框\r\n        apartmentRules, // 单元模态框 Form 校验数据\r\n        apartmentValue, // 单元模态框 Form 参数\r\n        apartmentSubmitLoading, // 单元提交加载\r\n        apartmentSubmit, // 单元模态框 Form 提交事件\r\n        deleteApartment, // 删除单元点击事件\r\n    }\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}