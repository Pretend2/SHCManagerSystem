{"ast":null,"code":"import { on, off } from './delegate';\nimport { getEventTarget } from './utils';\nconst traps = {\n  mousemoveoutside: new WeakMap(),\n  clickoutside: new WeakMap()\n};\n\nfunction createTrapHandler(name, el, originalHandler) {\n  if (name === 'mousemoveoutside') {\n    const moveHandler = e => {\n      if (el.contains(getEventTarget(e))) return;\n      originalHandler(e);\n    };\n\n    return {\n      mousemove: moveHandler,\n      touchstart: moveHandler\n    };\n  } else if (name === 'clickoutside') {\n    let mouseDownOutside = false;\n\n    const downHandler = e => {\n      mouseDownOutside = !el.contains(getEventTarget(e));\n    };\n\n    const upHanlder = e => {\n      if (!mouseDownOutside) return;\n      if (el.contains(getEventTarget(e))) return;\n      originalHandler(e);\n    };\n\n    return {\n      mousedown: downHandler,\n      mouseup: upHanlder,\n      touchstart: downHandler,\n      touchend: upHanlder\n    };\n  }\n\n  console.error( // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  `[evtd/create-trap-handler]: name \\`${name}\\` is invalid. This could be a bug of evtd.`);\n  return {};\n}\n\nfunction ensureTrapHandlers(name, el, handler) {\n  const handlers = traps[name];\n  let elHandlers = handlers.get(el);\n\n  if (elHandlers === undefined) {\n    handlers.set(el, elHandlers = new WeakMap());\n  }\n\n  let trapHandler = elHandlers.get(handler);\n\n  if (trapHandler === undefined) {\n    elHandlers.set(handler, trapHandler = createTrapHandler(name, el, handler));\n  }\n\n  return trapHandler;\n}\n\nfunction trapOn(name, el, handler, options) {\n  if (name === 'mousemoveoutside' || name === 'clickoutside') {\n    const trapHandlers = ensureTrapHandlers(name, el, handler);\n    Object.keys(trapHandlers).forEach(key => {\n      on(key, document, trapHandlers[key], options);\n    });\n    return true;\n  }\n\n  return false;\n}\n\nfunction trapOff(name, el, handler, options) {\n  if (name === 'mousemoveoutside' || name === 'clickoutside') {\n    const trapHandlers = ensureTrapHandlers(name, el, handler);\n    Object.keys(trapHandlers).forEach(key => {\n      off(key, document, trapHandlers[key], options);\n    });\n    return true;\n  }\n\n  return false;\n}\n\nexport { trapOff, trapOn };","map":{"version":3,"names":["on","off","getEventTarget","traps","mousemoveoutside","WeakMap","clickoutside","createTrapHandler","name","el","originalHandler","moveHandler","e","contains","mousemove","touchstart","mouseDownOutside","downHandler","upHanlder","mousedown","mouseup","touchend","console","error","ensureTrapHandlers","handler","handlers","elHandlers","get","undefined","set","trapHandler","trapOn","options","trapHandlers","Object","keys","forEach","key","document","trapOff"],"sources":["E:/VCode/SHC社区管理系统/shc_community_manager_system/node_modules/evtd/es/traps.js"],"sourcesContent":["import { on, off } from './delegate';\nimport { getEventTarget } from './utils';\nconst traps = {\n    mousemoveoutside: new WeakMap(),\n    clickoutside: new WeakMap()\n};\nfunction createTrapHandler(name, el, originalHandler) {\n    if (name === 'mousemoveoutside') {\n        const moveHandler = (e) => {\n            if (el.contains(getEventTarget(e)))\n                return;\n            originalHandler(e);\n        };\n        return {\n            mousemove: moveHandler,\n            touchstart: moveHandler\n        };\n    }\n    else if (name === 'clickoutside') {\n        let mouseDownOutside = false;\n        const downHandler = (e) => {\n            mouseDownOutside = !el.contains(getEventTarget(e));\n        };\n        const upHanlder = (e) => {\n            if (!mouseDownOutside)\n                return;\n            if (el.contains(getEventTarget(e)))\n                return;\n            originalHandler(e);\n        };\n        return {\n            mousedown: downHandler,\n            mouseup: upHanlder,\n            touchstart: downHandler,\n            touchend: upHanlder\n        };\n    }\n    console.error(\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    `[evtd/create-trap-handler]: name \\`${name}\\` is invalid. This could be a bug of evtd.`);\n    return {};\n}\nfunction ensureTrapHandlers(name, el, handler) {\n    const handlers = traps[name];\n    let elHandlers = handlers.get(el);\n    if (elHandlers === undefined) {\n        handlers.set(el, (elHandlers = new WeakMap()));\n    }\n    let trapHandler = elHandlers.get(handler);\n    if (trapHandler === undefined) {\n        elHandlers.set(handler, (trapHandler = createTrapHandler(name, el, handler)));\n    }\n    return trapHandler;\n}\nfunction trapOn(name, el, handler, options) {\n    if (name === 'mousemoveoutside' || name === 'clickoutside') {\n        const trapHandlers = ensureTrapHandlers(name, el, handler);\n        Object.keys(trapHandlers).forEach((key) => {\n            on(key, document, trapHandlers[key], options);\n        });\n        return true;\n    }\n    return false;\n}\nfunction trapOff(name, el, handler, options) {\n    if (name === 'mousemoveoutside' || name === 'clickoutside') {\n        const trapHandlers = ensureTrapHandlers(name, el, handler);\n        Object.keys(trapHandlers).forEach((key) => {\n            off(key, document, trapHandlers[key], options);\n        });\n        return true;\n    }\n    return false;\n}\nexport { trapOff, trapOn };\n"],"mappings":"AAAA,SAASA,EAAT,EAAaC,GAAb,QAAwB,YAAxB;AACA,SAASC,cAAT,QAA+B,SAA/B;AACA,MAAMC,KAAK,GAAG;EACVC,gBAAgB,EAAE,IAAIC,OAAJ,EADR;EAEVC,YAAY,EAAE,IAAID,OAAJ;AAFJ,CAAd;;AAIA,SAASE,iBAAT,CAA2BC,IAA3B,EAAiCC,EAAjC,EAAqCC,eAArC,EAAsD;EAClD,IAAIF,IAAI,KAAK,kBAAb,EAAiC;IAC7B,MAAMG,WAAW,GAAIC,CAAD,IAAO;MACvB,IAAIH,EAAE,CAACI,QAAH,CAAYX,cAAc,CAACU,CAAD,CAA1B,CAAJ,EACI;MACJF,eAAe,CAACE,CAAD,CAAf;IACH,CAJD;;IAKA,OAAO;MACHE,SAAS,EAAEH,WADR;MAEHI,UAAU,EAAEJ;IAFT,CAAP;EAIH,CAVD,MAWK,IAAIH,IAAI,KAAK,cAAb,EAA6B;IAC9B,IAAIQ,gBAAgB,GAAG,KAAvB;;IACA,MAAMC,WAAW,GAAIL,CAAD,IAAO;MACvBI,gBAAgB,GAAG,CAACP,EAAE,CAACI,QAAH,CAAYX,cAAc,CAACU,CAAD,CAA1B,CAApB;IACH,CAFD;;IAGA,MAAMM,SAAS,GAAIN,CAAD,IAAO;MACrB,IAAI,CAACI,gBAAL,EACI;MACJ,IAAIP,EAAE,CAACI,QAAH,CAAYX,cAAc,CAACU,CAAD,CAA1B,CAAJ,EACI;MACJF,eAAe,CAACE,CAAD,CAAf;IACH,CAND;;IAOA,OAAO;MACHO,SAAS,EAAEF,WADR;MAEHG,OAAO,EAAEF,SAFN;MAGHH,UAAU,EAAEE,WAHT;MAIHI,QAAQ,EAAEH;IAJP,CAAP;EAMH;;EACDI,OAAO,CAACC,KAAR,EACA;EACC,sCAAqCf,IAAK,6CAF3C;EAGA,OAAO,EAAP;AACH;;AACD,SAASgB,kBAAT,CAA4BhB,IAA5B,EAAkCC,EAAlC,EAAsCgB,OAAtC,EAA+C;EAC3C,MAAMC,QAAQ,GAAGvB,KAAK,CAACK,IAAD,CAAtB;EACA,IAAImB,UAAU,GAAGD,QAAQ,CAACE,GAAT,CAAanB,EAAb,CAAjB;;EACA,IAAIkB,UAAU,KAAKE,SAAnB,EAA8B;IAC1BH,QAAQ,CAACI,GAAT,CAAarB,EAAb,EAAkBkB,UAAU,GAAG,IAAItB,OAAJ,EAA/B;EACH;;EACD,IAAI0B,WAAW,GAAGJ,UAAU,CAACC,GAAX,CAAeH,OAAf,CAAlB;;EACA,IAAIM,WAAW,KAAKF,SAApB,EAA+B;IAC3BF,UAAU,CAACG,GAAX,CAAeL,OAAf,EAAyBM,WAAW,GAAGxB,iBAAiB,CAACC,IAAD,EAAOC,EAAP,EAAWgB,OAAX,CAAxD;EACH;;EACD,OAAOM,WAAP;AACH;;AACD,SAASC,MAAT,CAAgBxB,IAAhB,EAAsBC,EAAtB,EAA0BgB,OAA1B,EAAmCQ,OAAnC,EAA4C;EACxC,IAAIzB,IAAI,KAAK,kBAAT,IAA+BA,IAAI,KAAK,cAA5C,EAA4D;IACxD,MAAM0B,YAAY,GAAGV,kBAAkB,CAAChB,IAAD,EAAOC,EAAP,EAAWgB,OAAX,CAAvC;IACAU,MAAM,CAACC,IAAP,CAAYF,YAAZ,EAA0BG,OAA1B,CAAmCC,GAAD,IAAS;MACvCtC,EAAE,CAACsC,GAAD,EAAMC,QAAN,EAAgBL,YAAY,CAACI,GAAD,CAA5B,EAAmCL,OAAnC,CAAF;IACH,CAFD;IAGA,OAAO,IAAP;EACH;;EACD,OAAO,KAAP;AACH;;AACD,SAASO,OAAT,CAAiBhC,IAAjB,EAAuBC,EAAvB,EAA2BgB,OAA3B,EAAoCQ,OAApC,EAA6C;EACzC,IAAIzB,IAAI,KAAK,kBAAT,IAA+BA,IAAI,KAAK,cAA5C,EAA4D;IACxD,MAAM0B,YAAY,GAAGV,kBAAkB,CAAChB,IAAD,EAAOC,EAAP,EAAWgB,OAAX,CAAvC;IACAU,MAAM,CAACC,IAAP,CAAYF,YAAZ,EAA0BG,OAA1B,CAAmCC,GAAD,IAAS;MACvCrC,GAAG,CAACqC,GAAD,EAAMC,QAAN,EAAgBL,YAAY,CAACI,GAAD,CAA5B,EAAmCL,OAAnC,CAAH;IACH,CAFD;IAGA,OAAO,IAAP;EACH;;EACD,OAAO,KAAP;AACH;;AACD,SAASO,OAAT,EAAkBR,MAAlB"},"metadata":{},"sourceType":"module"}