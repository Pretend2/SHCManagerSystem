{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nconst __default__ = {\n  name: 'HousingOption'\n};\nimport { ref, toRefs, inject, reactive, watch, computed } from 'vue'; // 引入 naive-ui 组件\n\nimport { NModal, NCard, NSpace, NButton, NSelect, useMessage, NGridItem, NGrid } from 'naive-ui'; // 引入 axios\n\nimport axios from 'axios';\nimport QueryString from 'qs';\nimport { mergeObject } from '../util/BaseUtil'; // 接收全局变量\n\nexport default /*#__PURE__*/Object.assign(__default__, {\n  props: {\n    show: {\n      // 接收标题参数\n      type: Boolean,\n      // 参数类型为 Boolean 类型\n      default: false // 默认值\n\n    },\n    data: {\n      // 接收数据参数\n      type: Object,\n      default: {}\n    },\n    reqUrl: {\n      // 接收请求地址\n      type: String,\n      default: '/getHousesByBuildingId/'\n    },\n    defaultData: {\n      type: Object,\n      default: {\n        building: null,\n        housing: null\n      }\n    }\n  },\n\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const props = __props; // 引入 vue\n\n    const global = inject(\"global\"); // 获取 message 对象\n\n    const message = useMessage(); // props 参数\n    // 接收响应式数据\n\n    const {\n      show,\n      data,\n      reqUrl,\n      defaultData\n    } = toRefs(props);\n    watch(show, (newValue, oldValue) => {\n      selectOption.buildingValue = null;\n      selectOption.housingValue = null;\n      data.value.data = null;\n\n      if (newValue && defaultData.value.building != null && defaultData.value.housing != null) {\n        loadBuilding(res => {\n          for (let building of res) {\n            if (building.data.buildingNo === defaultData.value.building) {\n              loadHousing(building.data.id, res => {\n                for (let housing of res.data) {\n                  if (housing.building.buildingNo === defaultData.value.building) console.log(housing.building.buildingNo, housing.unit.unitNo + \" - \" + housing.housesNo);\n                }\n              });\n            }\n          }\n        });\n      }\n    }); // 加载\n\n    const buildingLoading = ref(false); // 楼栋\n\n    const housingLoading = ref(false); // 房屋\n\n    const selectDisabled = reactive({\n      buildingDisabled: computed(() => {\n        return housingLoading.value;\n      }),\n      housingDisabled: computed(() => {\n        return selectOption.buildingValue == null;\n      })\n    });\n    const selectOption = reactive({\n      buildingValue: null,\n      housingValue: null\n    });\n\n    const buildingUpdateValue = (value, option) => {\n      loadHousing(option.data.id);\n      housingOptions.value = [];\n      selectOption.housingValue = null;\n    };\n\n    const housingUpdateValue = (value, option) => {\n      housingInfo.value = option.data;\n      data.value.data = option.data;\n    }; // 楼栋数据\n\n\n    const buildingOptions = ref([]); // 房屋数据\n\n    const housingOptions = ref([]);\n    const housingInfo = ref({\n      id: null,\n      housesNo: null,\n      unit: {\n        unitNo: null\n      },\n      floor: null,\n      propertyType: null,\n      area: null,\n      remark: null\n    });\n    /**\r\n     * 加载楼栋信息\r\n     */\n\n    const loadBuilding = call => {\n      buildingLoading.value = true;\n      axios({\n        method: 'get',\n        url: global.api + '/getAllBuildings'\n      }).then(res => {\n        buildingOptions.value = [];\n\n        for (let building of res.data) {\n          const buildingData = {\n            label: building.name,\n            value: building.id,\n            data: building\n          };\n          buildingOptions.value.push(buildingData);\n        }\n\n        if (call != null) {\n          call(buildingOptions.value);\n        }\n      }).catch(err => {\n        message.error(\"楼栋加载失败！\" + err);\n      }).finally(() => {\n        buildingLoading.value = false;\n      });\n    };\n    /**\r\n     * 加载房屋信息\r\n     */\n\n\n    const loadHousing = (id, call) => {\n      housingLoading.value = true;\n      axios({\n        method: 'get',\n        url: global.api + reqUrl.value + id\n      }).then(res => {\n        housingOptions.value = [];\n\n        for (let housing of res.data) {\n          const housingData = {\n            label: housing.unit.unitNo + \" - \" + housing.housesNo,\n            value: housing.id,\n            data: housing\n          };\n          housingOptions.value.push(housingData);\n        }\n\n        if (call != null) {\n          call(res);\n        }\n      }).catch(err => {\n        message.error(\"房屋加载失败！\" + err);\n      }).finally(() => {\n        housingLoading.value = false;\n      });\n    }; // 调用加载楼栋\n\n\n    loadBuilding();\n    const __returned__ = {\n      global,\n      message,\n      props,\n      show,\n      data,\n      reqUrl,\n      defaultData,\n      buildingLoading,\n      housingLoading,\n      selectDisabled,\n      selectOption,\n      buildingUpdateValue,\n      housingUpdateValue,\n      buildingOptions,\n      housingOptions,\n      housingInfo,\n      loadBuilding,\n      loadHousing,\n      ref,\n      toRefs,\n      inject,\n      reactive,\n      watch,\n      computed,\n      NModal,\n      NCard,\n      NSpace,\n      NButton,\n      NSelect,\n      useMessage,\n      NGridItem,\n      NGrid,\n      axios,\n      QueryString,\n      mergeObject\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n});","map":{"version":3,"mappings":"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","names":["name","ref","toRefs","inject","reactive","watch","computed","NModal","NCard","NSpace","NButton","NSelect","useMessage","NGridItem","NGrid","axios","QueryString","mergeObject","global","message","show","data","reqUrl","defaultData","props","newValue","oldValue","selectOption","buildingValue","housingValue","value","building","housing","loadBuilding","res","buildingNo","loadHousing","id","console","log","unit","unitNo","housesNo","buildingLoading","housingLoading","selectDisabled","buildingDisabled","housingDisabled","buildingUpdateValue","option","housingOptions","housingUpdateValue","housingInfo","buildingOptions","floor","propertyType","area","remark","call","method","url","api","then","buildingData","label","push","catch","err","error","finally","housingData"],"sources":["D:/VCode/SHC社区管理系统/shc_community_manager_system/src/components/HousingOption.vue"],"sourcesContent":["<template>\r\n  <n-modal :show=\"show\" transform-origin=\"center\">\r\n    <n-card style=\"width: 800px\" title=\"选择房屋\" :bordered=\"false\" size=\"huge\" role=\"dialog\" aria-modal=\"true\">\r\n\r\n      <div class=\"my-select\">\r\n        <n-select v-model:value=\"selectOption.buildingValue\" filterable :loading=\"buildingLoading\"\r\n                  style=\"margin-right: 5px;\" @update:value=\"buildingUpdateValue\"\r\n                  :disabled=\"selectDisabled.buildingDisabled\" :options=\"buildingOptions\" placeholder=\"请选择楼栋\"/>\r\n        <n-select v-model:value=\"selectOption.housingValue\" @update:value=\"housingUpdateValue\" filterable\r\n                  :loading=\"housingLoading\" style=\"margin-left: 5px\" :disabled=\"selectDisabled.housingDisabled\"\r\n                  :options=\"housingOptions\" placeholder=\"请选择房屋\"/>\r\n      </div>\r\n\r\n      <n-grid :y-gap=\"16\" v-if=\"selectOption.housingValue != null\" style=\"margin: 16px;\" cols=\"1 400:2 600:3\">\r\n        <n-grid-item>\r\n          <div class=\"sub-info\">\r\n            房屋ID：{{ housingInfo.id }}\r\n          </div>\r\n        </n-grid-item>\r\n        <n-grid-item>\r\n          <div class=\"sub-info\">\r\n            房屋编号：{{ housingInfo.housesNo }}\r\n          </div>\r\n        </n-grid-item>\r\n        <n-grid-item>\r\n          <div class=\"sub-info\">\r\n            单元：{{ housingInfo.unit.unitNo }} 单元\r\n          </div>\r\n        </n-grid-item>\r\n        <n-grid-item>\r\n          <div class=\"sub-info\">\r\n            楼层： {{ housingInfo.floor }}\r\n          </div>\r\n        </n-grid-item>\r\n        <n-grid-item>\r\n          <div class=\"sub-info\">\r\n            户型：{{ housingInfo.propertyType }}\r\n          </div>\r\n        </n-grid-item>\r\n        <n-grid-item>\r\n          <div class=\"sub-info\">\r\n            建筑面积：{{ housingInfo.area }} 平方米\r\n          </div>\r\n        </n-grid-item>\r\n        <n-grid-item>\r\n          <div class=\"sub-info\">\r\n            备注：{{ housingInfo.remark }}\r\n          </div>\r\n        </n-grid-item>\r\n      </n-grid>\r\n\r\n      <slot name=\"content\"></slot>\r\n\r\n      <template #footer>\r\n        <slot name=\"footer\"></slot>\r\n      </template>\r\n    </n-card>\r\n  </n-modal>\r\n</template>\r\n\r\n<script setup>\r\n// 引入 vue\r\nimport {ref, toRefs, inject, reactive, watch, computed} from 'vue'\r\n// 引入 naive-ui 组件\r\nimport {\r\n  NModal, NCard, NSpace, NButton, NSelect,\r\n  useMessage, NGridItem, NGrid\r\n} from 'naive-ui'\r\n// 引入 axios\r\nimport axios from 'axios';\r\n\r\nimport QueryString from 'qs'\r\n\r\nimport {mergeObject} from '../util/BaseUtil'\r\n\r\n// 接收全局变量\r\nconst global = inject(\"global\")\r\n\r\n// 获取 message 对象\r\nconst message = useMessage();\r\n\r\n// props 参数\r\nconst props = defineProps({\r\n  show: { // 接收标题参数\r\n    type: Boolean, // 参数类型为 Boolean 类型\r\n    default: false // 默认值\r\n  },\r\n  data: { // 接收数据参数\r\n    type: Object,\r\n    default: {}\r\n  },\r\n  reqUrl: { // 接收请求地址\r\n    type: String,\r\n    default: '/getHousesByBuildingId/'\r\n  },\r\n  defaultData: {\r\n    type: Object,\r\n    default: {\r\n      building: null,\r\n      housing: null,\r\n    }\r\n  }\r\n})\r\n\r\n// 接收响应式数据\r\nconst {show, data, reqUrl, defaultData} = toRefs(props);\r\n\r\nwatch(show, (newValue, oldValue) => {\r\n  selectOption.buildingValue = null\r\n  selectOption.housingValue = null\r\n  data.value.data = null\r\n  if (newValue && defaultData.value.building != null && defaultData.value.housing != null) {\r\n    loadBuilding((res) => {\r\n      for (let building of res) {\r\n        if (building.data.buildingNo === defaultData.value.building) {\r\n          loadHousing(building.data.id, (res) => {\r\n            for (let housing of res.data) {\r\n              if (housing.building.buildingNo === defaultData.value.building)\r\n              console.log(housing.building.buildingNo,housing.unit.unitNo + \" - \" + housing.housesNo)\r\n            }\r\n          })\r\n        }\r\n      }\r\n    })\r\n  }\r\n})\r\n\r\n// 加载\r\nconst buildingLoading = ref(false) // 楼栋\r\nconst housingLoading = ref(false) // 房屋\r\n\r\nconst selectDisabled = reactive({\r\n  buildingDisabled: computed(() => {\r\n    return housingLoading.value\r\n  }),\r\n  housingDisabled: computed(() => {\r\n    return selectOption.buildingValue == null\r\n  })\r\n})\r\n\r\nconst selectOption = reactive({\r\n  buildingValue: null,\r\n  housingValue: null,\r\n})\r\n\r\nconst buildingUpdateValue = (value, option) => {\r\n  loadHousing(option.data.id)\r\n  housingOptions.value = []\r\n  selectOption.housingValue = null;\r\n}\r\n\r\nconst housingUpdateValue = (value, option) => {\r\n  housingInfo.value = option.data\r\n  data.value.data = option.data\r\n}\r\n\r\n// 楼栋数据\r\nconst buildingOptions = ref([])\r\n// 房屋数据\r\nconst housingOptions = ref([])\r\n\r\nconst housingInfo = ref({\r\n  id: null,\r\n  housesNo: null,\r\n  unit: {\r\n    unitNo: null,\r\n  },\r\n  floor: null,\r\n  propertyType: null,\r\n  area: null,\r\n  remark: null\r\n})\r\n\r\n/**\r\n * 加载楼栋信息\r\n */\r\nconst loadBuilding = (call) => {\r\n  buildingLoading.value = true\r\n  axios({\r\n    method: 'get',\r\n    url: global.api + '/getAllBuildings'\r\n  }).then(res => {\r\n    buildingOptions.value = []\r\n    for (let building of res.data) {\r\n      const buildingData = {\r\n        label: building.name,\r\n        value: building.id,\r\n        data: building\r\n      }\r\n      buildingOptions.value.push(buildingData)\r\n    }\r\n    if (call != null) {\r\n      call(buildingOptions.value)\r\n    }\r\n  }).catch(err => {\r\n    message.error(\"楼栋加载失败！\" + err)\r\n  }).finally(() => {\r\n    buildingLoading.value = false\r\n  })\r\n}\r\n/**\r\n * 加载房屋信息\r\n */\r\nconst loadHousing = (id, call) => {\r\n  housingLoading.value = true\r\n  axios({\r\n    method: 'get',\r\n    url: global.api + reqUrl.value + id\r\n  }).then(res => {\r\n    housingOptions.value = []\r\n    for (let housing of res.data) {\r\n      const housingData = {\r\n        label: housing.unit.unitNo + \" - \" + housing.housesNo,\r\n        value: housing.id,\r\n        data: housing\r\n      }\r\n      housingOptions.value.push(housingData)\r\n    }\r\n    if (call != null) {\r\n      call(res)\r\n    }\r\n  }).catch(err => {\r\n    message.error(\"房屋加载失败！\" + err)\r\n  }).finally(() => {\r\n    housingLoading.value = false\r\n  })\r\n}\r\n// 调用加载楼栋\r\nloadBuilding()\r\n\r\n</script>\r\n<script>\r\nexport default {\r\n  name: 'HousingOption'\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.my-select {\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}